<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Trigram (stripped single-mode)</title>
<style>
  :root{
    --bg:#a9cdf3;
    --bubble:#fff;
    --ink:#0b0b0b;

    --w1:#fff3b3;   /* yellow */
    --w2:#cfe8ff;   /* blue */
    --ol:#c9f3d6;   /* green overlap */
    --bad:#ffc9d2;  /* red/pink warning */
    --submit:#F4D2FD;

    --badge-drop:72px;
  }

  *{box-sizing:border-box}
  html,body{height:100%; overflow:hidden; background:var(--bg);}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    -webkit-tap-highlight-color:transparent;
    -webkit-touch-callout:none;
    user-select:none;
  }

  .wrap{
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:10px 14px 14px;
    gap:8px;
  }

  /* ===== top bar ===== */
  .topBar{
    width:min(920px, 96vw);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-top:4px;
  }
  .navBtn{
    width:42px; height:42px;
    border:2px solid rgba(0,0,0,.18);
    border-radius:14px;
    background:rgba(255,255,255,.75);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    text-decoration:none;
    color:var(--ink);
    font-weight:900;
    cursor:pointer;
  }
  .navBtn[aria-disabled="true"]{
    opacity:.35;
    cursor:default;
    pointer-events:none;
  }
  .count{
    font-weight:900;
    letter-spacing:.06em;
    opacity:.75;
  }
  .helpBtn{
    width:42px; height:42px;
    border:2px solid rgba(0,0,0,.18);
    border-radius:14px;
    background:rgba(255,255,255,.75);
    cursor:pointer;
    font-weight:900;
  }

  /* ===== clue ===== */
  .clue{
    width:min(920px, 96vw);
    background:rgba(255,255,255,.78);
    border:2px solid rgba(0,0,0,.12);
    border-radius:18px;
    padding:10px 14px;
    font-size:18px;
    font-weight:850;
    text-align:center;
  }
  .u-w1, .u-w2{
    text-decoration: underline;
    text-decoration-thickness: 3px;
    text-underline-offset: 5px;
  }
  .u-w1{ text-decoration-color: rgba(255,210,80,.95); }
  .u-w2{ text-decoration-color: rgba(120,170,255,.95); }

  /* ===== grid ===== */
  .gridDock{
    width:min(920px, 96vw);
    flex:1 1 auto;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding-top:10px;
  }
  .grid{
    --n:7;
    display:grid;
    grid-template-columns: repeat(var(--n), 1fr);
    gap:8px;
  }
  .cell{
    width:52px; height:64px;
    border-radius:16px;
    background:rgba(255,255,255,.92);
    border:2px solid rgba(0,0,0,.16);
    box-shadow: 0 6px 0 rgba(0,0,0,.10);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .cell.active{
    outline:3px solid rgba(0,0,0,.10);
    outline-offset:2px;
  }
  .cell input{
    width:100%;
    height:100%;
    border:0;
    outline:none;
    background:transparent;
    text-align:center;
    font-size:30px;
    font-weight:950;
    color:var(--ink);
    text-transform:uppercase;
    caret-color: rgba(0,0,0,.2);
  }
  html.has-kb .cell input{ pointer-events:none; }

  /* ===== message ===== */
  #msg{
    min-height:22px;
    font-weight:850;
    opacity:.9;
  }

  /* ===== buttons ===== */
  .btnRow{
    width:min(920px, 96vw);
    display:flex;
    justify-content:center;
    gap:10px;
    padding-bottom:6px;
  }
  .btn{
    border:3px solid rgba(0,0,0,.18);
    border-radius:999px;
    padding:10px 16px;
    min-width:128px;
    background:rgba(255,255,255,.78);
    font-weight:900;
    text-transform:uppercase;
    letter-spacing:.10em;
    cursor:pointer;
  }
  .btn:disabled{
    opacity:.40;
    cursor:default;
  }
  .btn.primary{
    background:var(--submit);
    border-color:rgba(0,0,0,.22);
  }

  /* ===== skill badge + next puzzle (kept) ===== */
  .skillDock{
    width:min(920px, 96vw);
    min-height:74px;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .skillBadge{
    position:absolute;
    left:50%;
    top:40%;
    transform:translate(-50%,-50%) translateY(var(--badge-drop)) scale(.86);
    opacity:0;
    pointer-events:none;
    transition:opacity .25s ease;
  }
  .wrap.solved .skillBadge{
    opacity:1;
    pointer-events:auto;
  }
  .skillBadgeInner{
    position:relative;
    overflow:hidden;
    min-width:120px;
    padding:10px 14px;
    border-radius:16px;
    text-align:center;

    --txt:#2a1a00;
    --bdr:rgba(255,220,130,.65);
    --g1:rgba(255,235,180,.95);
    --g2:rgba(255,200,90,.92);
    --g3:rgba(255,240,200,.96);
    --g4:rgba(255,190,70,.92);

    color:var(--txt);
    border:1px solid var(--bdr);
    background:linear-gradient(135deg,var(--g1) 0%,var(--g2) 35%,var(--g3) 70%,var(--g4) 100%);
    box-shadow:
      0 12px 26px rgba(255,200,80,.16),
      0 3px 10px rgba(0,0,0,.22);
  }
  .skillBadgeLabel{
    font-size:12px;
    font-weight:900;
    letter-spacing:.14em;
    text-transform:uppercase;
    opacity:.75;
  }
  .skillBadgeValue{
    font-size:34px;
    font-weight:950;
    line-height:1;
    margin-top:2px;
  }
  .nextPuzzleBtn{
    position:absolute;
    left:50%;
    top:40%;
    --next-y: calc(var(--badge-drop) + 120px);
    transform:translate(-50%,-50%) translateY(var(--next-y));
    opacity:0;
    visibility:hidden;
    pointer-events:none;

    border:3.5px solid var(--ink);
    border-radius:999px;
    padding:9px 16px;
    min-width:190px;
    font-size:15px;
    font-weight:950;
    color:var(--ink);
    background:rgba(255,255,255,.35);
    cursor:pointer;
    text-transform:uppercase;
    letter-spacing:.12em;
    box-shadow:0 7px 0 rgba(0,0,0,.16);
  }
  .nextPuzzleBtn:active{
    transform:translate(-50%,-50%) translateY(calc(var(--next-y) + 1px));
    box-shadow:0 6px 0 rgba(0,0,0,.16);
  }
  .wrap.solved .nextPuzzleBtn{
    opacity:1;
    visibility:visible;
    pointer-events:auto;
  }

  /* ===== keyboard ===== */
  #kbHost{
    position:fixed;
    left:0; right:0;
    bottom:0;
    z-index:9996;
    display:none;
    padding:10px 10px calc(18px + env(safe-area-inset-bottom));
    background:rgba(255,255,255,.90);
    backdrop-filter:blur(10px);
    -webkit-backdrop-filter:blur(10px);
    border-top:2px solid rgba(0,0,0,.14);
    touch-action:none;
  }
  html.has-kb #kbHost{ display:block; }
  #wrap.solved ~ #kbHost{ display:none !important; }

  .kb{ max-width:560px; margin:0 auto; display:flex; flex-direction:column; gap:8px; --keyW:clamp(28px,8.6vw,48px); }
  .kbRow{ display:flex; justify-content:center; gap:4px; }
  .kbKey{
    width:var(--keyW);
    height:48px;
    border:2px solid rgba(0,0,0,.16);
    border-radius:11px;
    background:rgba(255,255,255,.82);
    font-weight:900;
    font-size:18px;
    color:var(--ink);
    cursor:pointer;
    -webkit-touch-callout:none;
    -webkit-user-select:none;
    user-select:none;
  }
  .kbKey:active{ transform:translateY(1px); }
  .kbKey.wide{ width:calc(var(--keyW) * 1.55); font-size:12px; letter-spacing:.08em; }
  .kbKey.enter{ font-size:11px; letter-spacing:.02em; background:rgba(0,0,0,.07); }
  .kbKey.delete{ background:rgba(0,0,0,.07); }
  .kbKey.reset{ font-size:12px; color:rgba(0,0,0,.6); background:rgba(0,0,0,.07); }
  .kbKey.is-disabled{ opacity:.38; cursor:default; transform:none !important; }

  /* ===== modal ===== */
  .modalOverlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,.25);
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    z-index:9999;
  }
  .modalOverlay[aria-hidden="false"]{ display:flex; }
  .modalCard{
    width:min(520px, 96vw);
    background:rgba(255,255,255,.96);
    border:2px solid rgba(0,0,0,.15);
    border-radius:18px;
    box-shadow:0 16px 40px rgba(0,0,0,.22);
    overflow:hidden;
  }
  .modalHdr{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid rgba(0,0,0,.10); }
  .modalTitle{ font-weight:950; letter-spacing:.02em; }
  .modalX{ width:40px; height:40px; border-radius:12px; border:2px solid rgba(0,0,0,.12); background:rgba(255,255,255,.9); cursor:pointer; font-size:22px; font-weight:900; }
  .modalBody{ padding:14px 16px; font-weight:650; line-height:1.35; }
  .modalBody img{ width:100%; border-radius:14px; border:1px solid rgba(0,0,0,.10); }
</style>
</head>
<body>

<div class="wrap" id="wrap">

  <div class="topBar">
    <a class="navBtn" href="#" id="prevBtn" aria-label="Previous puzzle">‹</a>
    <div class="count" id="count">1/1</div>
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="helpBtn" id="helpBtn" type="button" aria-label="How to play">?</button>
      <a class="navBtn" href="#" id="nextBtn" aria-label="Next puzzle">›</a>
    </div>
  </div>

  <div class="clue" id="clue"></div>

  <div class="gridDock">
    <div class="grid" id="grid" style="--n:7"></div>
  </div>

  <div id="msg"></div>

  <div class="btnRow">
    <button class="btn" id="hintsBtn" type="button">Hint</button>
    <button class="btn primary" id="checkBtn" type="button" disabled>Check</button>
  </div>

  <div class="skillDock" id="skillDock" aria-label="Skill badge slot">
    <div class="skillBadge" id="skillBadge">
      <div class="skillBadgeInner gold">
        <div class="skillBadgeLabel">Skill</div>
        <div class="skillBadgeValue" id="skillBadgeValue">—</div>
      </div>
    </div>
    <button class="nextPuzzleBtn" id="nextPuzzleBtn" type="button">Next puzzle</button>
  </div>

</div>

<div id="kbHost" aria-label="On-screen keyboard"></div>

<div class="modalOverlay" id="helpOverlay" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modalHdr">
      <div class="modalTitle" id="helpTitle">How to play</div>
      <button class="modalX" id="helpClose" type="button" aria-label="Close">×</button>
    </div>
    <div class="modalBody" id="helpBody">
      <p>Type the <b>7-letter answer</b>, then press <b>Check</b>.</p>
      <p>The answer contains a 3-letter chunk (a <i>trigram</i>) from each clue word.</p>
      <p>(Hints and skill scoring are currently disabled in this stripped version, but the UI is kept for later.)</p>
      <img src="demo_grid.gif" alt="Grid demo" loading="eager" decoding="async">
    </div>
  </div>
</div>

<script>
/* =======================
   Puzzles
   ======================= */
const PUZZLES = [
{ clue:"Ample bounty", word1:"ample", word2:"bounty", answer:"aplenty", tri1:"ple", tri2:"nty" },
  { clue:"Vegans' picnic", word1:"vegans", word2:"picnic", answer:"organic", tri1:"gan", tri2:"nic" },
  { clue:"Wheezy groans", word1:"wheezy", word2:"groans", answer:"banshee", tri1:"hee", tri2:"ans" },
  { clue:"Absurd dream", word1:"absurd", word2:"dream", answer:"surreal", tri1:"sur", tri2:"rea" },
  { clue:"Summer sunset", word1:"summer", word2:"sunset", answer:"immense", tri1:"mme", tri2:"nse" },
  { clue:"Puzzles granny", word1:"puzzles", word2:"granny", answer:"rankles", tri1:"les", tri2:"ran" },
  { clue:"Custom jigsaw", word1:"custom", word2:"jigsaw", answer:"sawdust", tri1:"ust", tri2:"saw" },
  { clue:"Fresh socks", word1:"fresh", word2:"socks", answer:"restock", tri1:"res", tri2:"ock" },
  { clue:"Rotten tycoon!", word1:"rotten", word2:"tycoon", answer:"boycott", tri1:"ott", tri2:"yco" },
  { clue:"Butch alien", word1:"butch", word2:"alien", answer:"halibut", tri1:"but", tri2:"ali" },
  { clue:"Pancake ordeal", word1:"pancake", word2:"ordeal", answer:"deadpan", tri1:"pan", tri2:"dea" },
  { clue:"Embrace rawness", word1:"embrace", word2:"rawness", answer:"braless", tri1:"bra", tri2:"ess" },
  { clue:"Trucker reunion", word1:"trucker", word2:"reunion", answer:"ruction", tri1:"ruc", tri2:"ion" },
  { clue:"Bamboo catalog", word1:"bamboo", word2:"catalog", answer:"logbook", tri1:"boo", tri2:"log" },
  { clue:"Pesky waiver", word1:"pesky", word2:"waiver", answer:"skydive", tri1:"sky", tri2:"ive" },
  { clue:"Pasta sarcasm", word1:"pasta", word2:"sarcasm", answer:"starchy", tri1:"sta", tri2:"arc" },
  { clue:"Cheeky bishop!", word1:"cheeky", word2:"bishop", answer:"cherish", tri1:"che", tri2:"ish" },
  { clue:"Emotion robbed", word1:"emotion", word2:"robbed", answer:"robotic", tri1:"oti", tri2:"rob" },
  { clue:"Coffee breath", word1:"coffee", word2:"breath", answer:"offbeat", tri1:"off", tri2:"eat" },
  { clue:"Divorce payment", word1:"divorce", word2:"payment", answer:"percent", tri1:"rce", tri2:"ent" },
  { clue:"Hippo's radius", word1:"hippos", word2:"radius", answer:"adipose", tri1:"pos", tri2:"adi" },
  { clue:"Popular encore", word1:"popular", word2:"encore", answer:"popcorn", tri1:"pop", tri2:"cor" },
  { clue:"Campus admirer", word1:"campus", word2:"admirer", answer:"vampire", tri1:"amp", tri2:"ire" },
  { clue:"Apple drama", word1:"apple", word2:"drama", answer:"trample", tri1:"ple", tri2:"ram" },
  { clue:"Modify image", word1:"modify", word2:"image", answer:"magnify", tri1:"ify", tri2:"mag" },
  { clue:"Karaoke wonder", word1:"karaoke", word2:"wonder", answer:"parader", tri1:"ara", tri2:"der" },
  { clue:"Curious mailman", word1:"curious", word2:"mailman", answer:"curtail", tri1:"cur", tri2:"ail" },
  { clue:"Atomic secrets", word1:"atomic", word2:"secrets", answer:"creator", tri1:"ato", tri2:"cre" },
  { clue:"Incense factory", word1:"incense", word2:"factory", answer:"sensory", tri1:"ens", tri2:"ory" },
  { clue:"Crafty madame", word1:"crafty", word2:"madame", answer:"macrame", tri1:"cra", tri2:"ame" },
  { clue:"Jinxed bonbon", word1:"jinxed", word2:"bonbon", answer:"unboxed", tri1:"xed", tri2:"nbo" },
  { clue:"Laundry cleaner", word1:"laundry", word2:"cleaner", answer:"mundane", tri1:"und", tri2:"ane" },
  { clue:"Wholly muscle?", word1:"wholly", word2:"muscle", answer:"mollusc", tri1:"oll", tri2:"usc" },
  { clue:"Stupid gossip", word1:"stupid", word2:"gossip", answer:"insipid", tri1:"pid", tri2:"sip" },
  { clue:"Winter weaver", word1:"winter", word2:"weaver", answer:"sweater", tri1:"ter", tri2:"wea" },
  { clue:"Shark pontoon", word1:"shark", word2:"pontoon", answer:"harpoon", tri1:"har", tri2:"oon" },
  { clue:"Koalas launch!", word1:"koalas", word2:"launch", answer:"unclasp", tri1:"las", tri2:"unc" },
  { clue:"Junior minds", word1:"junior", word2:"minds", answer:"minions", tri1:"nio", tri2:"min" },
  { clue:"Library trolley", word1:"library", word2:"trolley", answer:"braille", tri1:"bra", tri2:"lle" },
  { clue:"Bikini weather!", word1:"bikini", word2:"weather", answer:"gherkin", tri1:"kin", tri2:"her" },
  { clue:"Savage queens", word1:"savage", word2:"queens", answer:"teenage", tri1:"age", tri2:"een" },
  { clue:"Pursue beauty", word1:"pursue", word2:"beauty", answer:"auteurs", tri1:"urs", tri2:"aut" },
  { clue:"Toasted success!", word1:"toasted", word2:"success", answer:"hostess", tri1:"ste", tri2:"ess" },
  { clue:"Beyond cryptic", word1:"beyond", word2:"cryptic", answer:"cryonic", tri1:"yon", tri2:"cry" },
  { clue:"Axolotl anarchy", word1:"axolotl", word2:"anarchy", answer:"blotchy", tri1:"lot", tri2:"chy" },
  { clue:"Thorny upstart", word1:"thorny", word2:"upstart", answer:"warthog", tri1:"tho", tri2:"art" },
  { clue:"Inane hiccup?", word1:"inane", word2:"hiccup", answer:"chicane", tri1:"ane", tri2:"hic" },
  { clue:"Podcast blunder", word1:"podcast", word2:"blunder", answer:"astound", tri1:"ast", tri2:"und" },
  { clue:"Titanic struck!", word1:"titanic", word2:"struck", answer:"tantrum", tri1:"tan", tri2:"tru" },
  { clue:"Damaged thumbs", word1:"damaged", word2:"thumbs", answer:"umbrage", tri1:"age", tri2:"umb" },
  { clue:"Monthly malice", word1:"monthly", word2:"malice", answer:"alimony", tri1:"mon", tri2:"ali" },
  { clue:"Switch phones", word1:"switch", word2:"phones", answer:"witness", tri1:"wit", tri2:"nes" },
  { clue:"Tamed debate", word1:"tamed", word2:"debate", answer:"mediate", tri1:"med", tri2:"ate" },
  { clue:"Lonely Martian", word1:"lonely", word2:"martian", answer:"elysian", tri1:"ely", tri2:"ian" },
  { clue:"Raunchy truth", word1:"raunchy", word2:"truth", answer:"uncouth", tri1:"unc", tri2:"uth" },
  { clue:"Nearly walked", word1:"nearly", word2:"walked", answer:"sneaked", tri1:"nea", tri2:"ked" },
  { clue:"Hazard symbol", word1:"hazard", word2:"symbol", answer:"bollard", tri1:"ard", tri2:"bol" },
  { clue:"Perform, monkey!", word1:"perform", word2:"monkey", answer:"hormone", tri1:"orm", tri2:"mon" },
  { clue:"Further charges", word1:"further", word2:"charges", answer:"harsher", tri1:"her", tri2:"har" },
  { clue:"Excess whiskey", word1:"excess", word2:"whiskey", answer:"keyless", tri1:"ess", tri2:"key" },
  { clue:"Ukulele museum", word1:"ukulele", word2:"museum", answer:"useless", tri1:"ele", tri2:"use" },
  { clue:"Macho spandex", word1:"macho", word2:"spandex", answer:"panache", tri1:"ach", tri2:"pan" },
  { clue:"Chaotic grandma", word1:"chaotic", word2:"grandma", answer:"frantic", tri1:"tic", tri2:"ran" },
  { clue:"Ninety friends", word1:"ninety", word2:"friends", answer:"variety", tri1:"ety", tri2:"rie" },
  { clue:"Forged ballot", word1:"forged", word2:"ballot", answer:"alleged", tri1:"ged", tri2:"all" },
  { clue:"Better apology", word1:"better", word2:"apology", answer:"politer", tri1:"ter", tri2:"pol" },
  { clue:"Grabbed hummus", word1:"grabbed", word2:"hummus", answer:"thumbed", tri1:"bed", tri2:"hum" },
  { clue:"Woven lullaby", word1:"woven", word2:"lullaby", answer:"novella", tri1:"ove", tri2:"lla" },
  { clue:"Smooth haptic", word1:"smooth", word2:"haptic", answer:"osmotic", tri1:"smo", tri2:"tic" },
  { clue:"Artisan cakes", word1:"artisan", word2:"cakes", answer:"partake", tri1:"art", tri2:"ake" },
  { clue:"Heroic abandon", word1:"heroic", word2:"abandon", answer:"android", tri1:"roi", tri2:"and" },
  { clue:"Toilet jostle!", word1:"toilet", word2:"jostle", answer:"hostile", tri1:"ile", tri2:"ost" },
  { clue:"Circus target", word1:"circus", word2:"target", answer:"custard", tri1:"cus", tri2:"tar" },
  { clue:"Castle echoes", word1:"castle", word2:"echoes", answer:"chortle", tri1:"tle", tri2:"cho" },
  { clue:"Ignite nickel", word1:"ignite", word2:"nickel", answer:"nitpick", tri1:"nit", tri2:"ick" },
  { clue:"Gumboot suction", word1:"gumboot", word2:"suction", answer:"succumb", tri1:"umb", tri2:"suc" },
  { clue:"Kitchen slogan", word1:"kitchen", word2:"slogan", answer:"ganache", tri1:"che", tri2:"gan" },
  { clue:"Airport hordes", word1:"airport", word2:"hordes", answer:"despair", tri1:"air", tri2:"des" },
  { clue:"Toned cowboy", word1:"toned", word2:"cowboy", answer:"jawbone", tri1:"one", tri2:"wbo" },
  { clue:"Genial words", word1:"genial", word2:"words", answer:"cordial", tri1:"ial", tri2:"ord" },
  { clue:"Wildly hungry", word1:"wildly", word2:"hungry", answer:"ungodly", tri1:"dly", tri2:"ung" },
  { clue:"Harsh pencil", word1:"harsh", word2:"pencil", answer:"sharpen", tri1:"har", tri2:"pen" },
  { clue:"Raccoon scuffle!", word1:"raccoon", word2:"scuffle", answer:"buffoon", tri1:"oon", tri2:"uff" },
  { clue:"Silent heels", word1:"silent", word2:"heels", answer:"genteel", tri1:"ent", tri2:"eel" },
  { clue:"Escaped turkey", word1:"escaped", word2:"turkey", answer:"capture", tri1:"cap", tri2:"tur" },
  { clue:"Discard fruit", word1:"discard", word2:"fruit", answer:"biscuit", tri1:"isc", tri2:"uit" },
  { clue:"Upstage comedy?", word1:"upstage", word2:"comedy", answer:"tragedy", tri1:"age", tri2:"edy" },
  { clue:"Sunrise alarm", word1:"sunrise", word2:"alarm", answer:"malaise", tri1:"ise", tri2:"ala" },
  { clue:"Beguile prince", word1:"beguile", word2:"prince", answer:"silence", tri1:"ile", tri2:"nce" },
  { clue:"Awesome pitch!", word1:"awesome", word2:"pitch", answer:"epitome", tri1:"ome", tri2:"pit" },
  { clue:"Husband erred", word1:"husband", word2:"erred", answer:"errands", tri1:"and", tri2:"err" },
  { clue:"Conceal milkman", word1:"conceal", word2:"milkman", answer:"romance", tri1:"nce", tri2:"man" },
  { clue:"Azure outfit", word1:"azure", word2:"outfit", answer:"couture", tri1:"ure", tri2:"out" },
  { clue:"Surveil mobster", word1:"surveil", word2:"mobster", answer:"observe", tri1:"rve", tri2:"obs" },
  { clue:"Storms adobe?", word1:"storms", word2:"adobe", answer:"tornado", tri1:"tor", tri2:"ado" },
  { clue:"Achieve plural?", word1:"achieve", word2:"plural", answer:"several", tri1:"eve", tri2:"ral" },
  { clue:"Grubby tricks", word1:"grubby", word2:"tricks", answer:"rubrics", tri1:"rub", tri2:"ric" },
  { clue:"Marched along", word1:"marched", word2:"along", answer:"echelon", tri1:"che", tri2:"lon" },
  { clue:"Stamina, golly", word1:"stamina", word2:"golly", answer:"finally", tri1:"ina", tri2:"lly" },
  { clue:"Bounty mania", word1:"bounty", word2:"mania", answer:"manhunt", tri1:"unt", tri2:"man" },
  { clue:"Citrus riots!", word1:"citrus", word2:"riots", answer:"vitriol", tri1:"itr", tri2:"rio" },
  { clue:"Market chutney", word1:"market", word2:"chutney", answer:"ketchup", tri1:"ket", tri2:"chu" },
  { clue:"Stolen memory", word1:"stolen", word2:"memory", answer:"history", tri1:"sto", tri2:"ory" },
  { clue:"Funky chicken!", word1:"funky", word2:"chicken", answer:"drunken", tri1:"unk", tri2:"ken" },
  { clue:"Outback erosion", word1:"outback", word2:"erosion", answer:"reroute", tri1:"out", tri2:"ero" },
  { clue:"Whose finery?", word1:"whose", word2:"finery", answer:"hosiery", tri1:"hos", tri2:"ery" },
  { clue:"Crypto babble", word1:"crypto", word2:"babble", answer:"crybaby", tri1:"cry", tri2:"bab" },
  { clue:"Fairly acute", word1:"fairly", word2:"acute", answer:"haircut", tri1:"air", tri2:"cut" },
  { clue:"Anchovy drizzle", word1:"anchovy", word2:"drizzle", answer:"chorizo", tri1:"cho", tri2:"riz" },
  { clue:"Danger, mishaps", word1:"danger", word2:"mishaps", answer:"anguish", tri1:"ang", tri2:"ish" },
  { clue:"Cadet arsenal", word1:"cadet", word2:"arsenal", answer:"grenade", tri1:"ade", tri2:"ena" },
  { clue:"Sworn unique", word1:"sworn", word2:"unique", answer:"unicorn", tri1:"orn", tri2:"uni" },
  { clue:"Extant threat", word1:"extant", word2:"threat", answer:"anthrax", tri1:"ant", tri2:"thr" },
  { clue:"Carbon refills", word1:"carbon", word2:"refills", answer:"careful", tri1:"car", tri2:"ref" },
  { clue:"Laser sighted!", word1:"laser", word2:"sighted", answer:"blasted", tri1:"las", tri2:"ted" },
  { clue:"Nightly affray", word1:"nightly", word2:"affray", answer:"fraught", tri1:"ght", tri2:"fra" },
  { clue:"Slammed pothole", word1:"slammed", word2:"pothole", answer:"mammoth", tri1:"amm", tri2:"oth" },
  { clue:"Granny, please?", word1:"granny", word2:"please", answer:"grapple", tri1:"gra", tri2:"ple" },
  { clue:"Armpit revenge", word1:"armpit", word2:"revenge", answer:"impinge", tri1:"mpi", tri2:"nge" },
  { clue:"Feisty temper", word1:"feisty", word2:"temper", answer:"persist", tri1:"ist", tri2:"per" }
];

/* =======================
   Stripped single-mode core
   Removed: hints UI/minigrid/fly-ins, trigram highlighting/dragging,
            clue-word trigram actions, auto-promotion, assisted mode, skill scoring.
   Kept: messages, clue underlines, hint button (no-op), skill badge slot.
   ======================= */

const LS_KEY = "trigramLite_v1";

/* Keep message copy (even if unused for now) */
const MAX3_TEXT      = "Max 3 contiguous letters allowed";
const TWOTRI_TEXT    = "Two trigrams from same word";
const OVERLAP_TEXT   = "1-letter overlap allowed ✓";
const OVERLAP2_TEXT  = "2-letter overlap not allowed";
const HINT_EXCL_TEXT = "Your hint excluded this trigram";
const DBLTAP_TEXT    = "Double tap to cycle";

/* DOM */
const el = {
  wrap: document.getElementById("wrap"),
  clue: document.getElementById("clue"),
  grid: document.getElementById("grid"),
  msg: document.getElementById("msg"),
  hintsBtn: document.getElementById("hintsBtn"),
  checkBtn: document.getElementById("checkBtn"),
  nextPuzzleBtn: document.getElementById("nextPuzzleBtn"),
  prevBtn: document.getElementById("prevBtn"),
  nextBtn: document.getElementById("nextBtn"),
  count: document.getElementById("count"),
  kbHost: document.getElementById("kbHost"),
  helpBtn: document.getElementById("helpBtn"),
  helpOverlay: document.getElementById("helpOverlay"),
  helpClose: document.getElementById("helpClose"),
  skillBadgeValue: document.getElementById("skillBadgeValue"),
};

const htmlEl = document.documentElement;

/* State */
const state = {
  i: 0,
  n: 7,
  grid: [],
  focus: 0,
  finished: false,
  hintCount: 0,
  useKB: false,
  modalOpen: false,
  transientTimer: null,
};

const STORE = loadStore();

init();

/* =======================
   init
   ======================= */
function init(){
  precomputePuzzles();
  buildKeyboard();          // must exist before enabling has-kb
  wireUI();
  setPuzzleIndex(firstIncompleteIndex());
  ensureKeyboardMode(true);
  renderAll();
}

/* =======================
   helpers
   ======================= */
function precomputePuzzles(){
  for(const p of PUZZLES){
    p._ans = String(p.answer || "").toUpperCase();
    p._clue = String(p.clue || "").trim();
  }
}
function cur(){ return PUZZLES[state.i]; }
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
function isAlpha(ch){ return /^[A-Z]$/.test(ch); }
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#39;");
}
function hintPhraseText(h){
  if(h<=0) return "no hints";
  if(h===1) return "1 hint";
  return `${h} hints`;
}

/* =======================
   Storage (minimal)
   ======================= */
function canLS(){
  try{ localStorage.setItem("__tg_test__","1"); localStorage.removeItem("__tg_test__"); return true; }
  catch(e){ return false; }
}
function loadStore(){
  const blank = { results:{}, progress:{} };
  if(!canLS()) return blank;
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return blank;
    const obj = JSON.parse(raw);
    obj.results = obj.results && typeof obj.results==="object" ? obj.results : {};
    obj.progress = obj.progress && typeof obj.progress==="object" ? obj.progress : {};
    return obj;
  }catch(e){ return blank; }
}
function saveStore(){
  if(!canLS()) return;
  try{ localStorage.setItem(LS_KEY, JSON.stringify(STORE)); }catch(e){}
}
function firstIncompleteIndex(){
  for(let i=0;i<PUZZLES.length;i++){ if(!STORE.results[String(i)]?.done) return i; }
  return 0;
}

/* =======================
   Messages
   ======================= */
function setMsg(html){ el.msg.innerHTML = html || ""; }
function setTransientMsg(txt, ms=1200){
  clearTransientMsg();
  setMsg(escapeHtml(txt));
  state.transientTimer = setTimeout(()=>{ setMsg(""); state.transientTimer=null; }, ms);
}
function clearTransientMsg(){
  if(state.transientTimer){ clearTimeout(state.transientTimer); state.transientTimer=null; }
}

/* =======================
   Navigation + puzzle state
   ======================= */
function setPuzzleIndex(i){
  state.i = clamp(i, 0, PUZZLES.length-1);
  state.n = cur()._ans.length || 7;
  state.grid = Array(state.n).fill("");
  state.focus = 0;
  state.finished = false;
  state.hintCount = 0;

  const res = STORE.results[String(state.i)];
  if(res?.done){
    state.finished = true;
    state.grid = cur()._ans.split("");
    el.wrap.classList.add("solved");
    setMsg(`Solved — ${hintPhraseText(res.hintCount ?? 0)}.`);
  }else{
    el.wrap.classList.remove("solved");
    setMsg("");
  }

  const prog = STORE.progress[String(state.i)];
  if(!state.finished && prog?.grid && Array.isArray(prog.grid) && prog.grid.length === state.n){
    state.grid = prog.grid.map(x => (isAlpha(String(x||"").toUpperCase()) ? String(x).toUpperCase() : ""));
    state.focus = clamp(Number(prog.focus ?? 0), 0, state.n-1);
  }

  renderAll();
}
function saveProgress(){
  if(state.finished){ delete STORE.progress[String(state.i)]; saveStore(); return; }
  STORE.progress[String(state.i)] = { grid: state.grid, focus: state.focus, ts: Date.now() };
  saveStore();
}

/* =======================
   Render
   ======================= */
function renderAll(){
  renderCount();
  renderClue();
  renderGrid();
  renderButtons();
  // keep skill badge placeholder for future use
  if(el.skillBadgeValue) el.skillBadgeValue.textContent = "—";
}
function renderCount(){
  if(!el.count) return;
  el.count.textContent = `${state.i+1}/${PUZZLES.length}`;
  if(el.prevBtn) el.prevBtn.setAttribute("aria-disabled", String(state.i<=0));
  if(el.nextBtn) el.nextBtn.setAttribute("aria-disabled", String(state.i>=PUZZLES.length-1));
}
function renderClue(){
  if(!el.clue) return;
  const parts = cur()._clue.split(/\s+/).filter(Boolean);
  const a = parts[0] || "";
  const b = parts.slice(1).join(" ") || "";
  el.clue.innerHTML = `<span class="u-w1">${escapeHtml(a)}</span> <span class="u-w2">${escapeHtml(b)}</span>`;
}
function renderGrid(){
  if(!el.grid) return;
  el.grid.style.setProperty("--n", String(state.n));
  el.grid.innerHTML = "";

  for(let i=0;i<state.n;i++){
    const cell = document.createElement("div");
    cell.className = "cell" + ((!state.finished && i===state.focus) ? " active" : "");
    const inp = document.createElement("input");
    inp.type="text";
    inp.inputMode = "none";
    inp.autocapitalize="none";
    inp.autocomplete="off";
    inp.autocorrect="off";
    inp.spellcheck=false;
    inp.maxLength=1;
    inp.value = state.grid[i] || "";
    inp.readOnly = state.useKB || state.finished;
    inp.tabIndex = state.useKB ? -1 : 0;

    inp.addEventListener("focus", ()=>{ state.focus=i; renderGridActiveOnly(); });
    inp.addEventListener("keydown", (e)=>onKeyDown(e,i));
    inp.addEventListener("input", (e)=>onNativeInput(e,i));

    cell.addEventListener("pointerdown", (e)=>{
      if(state.modalOpen) return;
      e.preventDefault();
      if(state.finished) return;
      state.focus=i;
      renderGridActiveOnly();
      if(!state.useKB) inp.focus();
    });

    cell.appendChild(inp);
    el.grid.appendChild(cell);
  }
}
function renderGridActiveOnly(){
  const cells = el.grid.querySelectorAll(".cell");
  cells.forEach((c,idx)=>c.classList.toggle("active", !state.finished && idx===state.focus));
}
function renderButtons(){
  if(el.hintsBtn) el.hintsBtn.disabled = !!state.finished; // no-op but kept
  if(el.checkBtn){
    const ready = !state.finished && state.grid.every(ch=>!!ch);
    el.checkBtn.disabled = !ready;
  }
  if(el.nextPuzzleBtn){
    // visible via CSS only when solved
    const allDone = PUZZLES.every((_,i)=>STORE.results[String(i)]?.done);
    el.nextPuzzleBtn.disabled = allDone;
  }
  updateKeyboardEnabledState();
}

/* =======================
   Input
   ======================= */
function setChar(i,ch){
  state.grid[i]=ch;
  saveProgress();
  renderButtons();
}
function typeLetter(ch){
  if(state.finished || state.modalOpen) return;
  const up = String(ch||"").slice(0,1).toUpperCase();
  if(!isAlpha(up)) return;
  setChar(state.focus, up);
  state.focus = clamp(state.focus+1, 0, state.n-1);
  renderAll();
}
function backspace(){
  if(state.finished || state.modalOpen) return;
  if(state.grid[state.focus]){
    setChar(state.focus, "");
  }else if(state.focus>0){
    state.focus--;
    setChar(state.focus, "");
  }
  renderAll();
}
function resetGrid(){
  if(state.finished || state.modalOpen) return;
  state.grid = Array(state.n).fill("");
  state.focus = 0;
  saveProgress();
  setMsg("");
  renderAll();
}
function onKeyDown(e, idx){
  if(state.useKB || state.finished || state.modalOpen) return;
  if(e.key==="Backspace"){ e.preventDefault(); state.focus=idx; backspace(); return; }
  if(e.key==="Enter"){ e.preventDefault(); onCheck(); return; }
  if(e.key.length===1){
    const up=e.key.toUpperCase();
    if(isAlpha(up)){ e.preventDefault(); state.focus=idx; typeLetter(up); }
  }
}
function onNativeInput(e, idx){
  if(state.useKB || state.finished || state.modalOpen){
    e.target.value = state.grid[idx] || "";
    return;
  }
  const v=(e.target.value||"").toUpperCase().slice(-1);
  state.focus=idx;
  if(isAlpha(v)) typeLetter(v);
  else setChar(idx,"");
  e.target.value = state.grid[idx] || "";
}

/* =======================
   Check
   ======================= */
function onCheck(){
  if(state.finished || state.modalOpen) return;
  if(state.grid.some(ch=>!ch)){
    setTransientMsg(`Fill all ${state.n} tiles first.`, 1400);
    return;
  }
  const attempt = state.grid.join("").toUpperCase();
  if(attempt===cur()._ans){
    state.finished=true;
    el.wrap.classList.add("solved");
    STORE.results[String(state.i)] = { done:true, hintCount: state.hintCount, ts:Date.now() };
    delete STORE.progress[String(state.i)];
    saveStore();
    setMsg(`Correct — ${hintPhraseText(state.hintCount)}!`);
    renderAll();
  }else{
    setTransientMsg("Not quite.", 1200);
  }
}

/* =======================
   Keyboard (minimal)
   ======================= */
function shouldUseCustomKB(){
  const coarse = window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
  const small  = window.matchMedia && window.matchMedia("(max-width: 920px)").matches;
  return !!(coarse && small);
}
function ensureKeyboardMode(rerender=false){
  const want = shouldUseCustomKB();
  if(state.useKB===want) return;
  state.useKB = want;
  htmlEl.classList.toggle("has-kb", want);
  if(rerender) renderAll();
}
function buildKeyboard(){
  if(!el.kbHost) return;
  el.kbHost.innerHTML = "";
  const kb = document.createElement("div");
  kb.className = "kb";

  const rows = ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"];
  for(const row of rows){
    const r = document.createElement("div");
    r.className = "kbRow";
    for(const ch of row){
      r.appendChild(makeKey(ch, "letter", ch));
    }
    kb.appendChild(r);
  }

  const r4 = document.createElement("div");
  r4.className = "kbRow";
  r4.appendChild(makeKey("RESET","reset"));
  r4.appendChild(makeKey("⌫","delete"));
  r4.appendChild(makeKey("ENTER","enter"));
  kb.appendChild(r4);

  el.kbHost.appendChild(kb);

  el.kbHost.addEventListener("pointerdown", (e)=>{
    const btn = e.target.closest("button.kbKey");
    if(!btn) return;
    e.preventDefault();
    e.stopPropagation();
    if(btn.classList.contains("is-disabled")) return;

    const kind = btn.dataset.kind;
    const val  = btn.dataset.val || "";
    if(kind==="letter") typeLetter(val);
    else if(kind==="delete") backspace();
    else if(kind==="enter") onCheck();
    else if(kind==="reset") resetGrid();
  }, {passive:false});
}
function makeKey(label, kind, val){
  const b = document.createElement("button");
  b.type = "button";
  b.className = "kbKey";
  b.textContent = label;
  b.dataset.kind = kind;
  if(val) b.dataset.val = val;
  if(kind==="reset") b.classList.add("wide","reset");
  if(kind==="delete") b.classList.add("wide","delete");
  if(kind==="enter") b.classList.add("wide","enter");
  return b;
}
function updateKeyboardEnabledState(){
  if(!el.kbHost) return;
  const dis = state.finished || state.modalOpen;
  el.kbHost.querySelectorAll(".kbKey").forEach(k=>k.classList.toggle("is-disabled", dis));
}

/* =======================
   UI wiring
   ======================= */
function wireUI(){
  el.hintsBtn?.addEventListener("click", (e)=>{ e.preventDefault(); /* no-op */ });
  el.checkBtn?.addEventListener("click", (e)=>{ e.preventDefault(); onCheck(); });
  el.prevBtn?.addEventListener("click", (e)=>{ e.preventDefault(); if(state.i>0) setPuzzleIndex(state.i-1); });
  el.nextBtn?.addEventListener("click", (e)=>{ e.preventDefault(); if(state.i<PUZZLES.length-1) setPuzzleIndex(state.i+1); });

  el.nextPuzzleBtn?.addEventListener("click", (e)=>{
    e.preventDefault();
    setPuzzleIndex(firstIncompleteIndex());
  });

  // Help modal
  el.helpBtn?.addEventListener("click", ()=>openModal(el.helpOverlay));
  el.helpClose?.addEventListener("click", ()=>closeModal(el.helpOverlay));
  el.helpOverlay?.addEventListener("pointerdown", (e)=>{
    if(e.target === el.helpOverlay) closeModal(el.helpOverlay);
  }, {passive:true});

  window.addEventListener("resize", ()=>ensureKeyboardMode(true), {passive:true});
  if(window.visualViewport) window.visualViewport.addEventListener("resize", ()=>ensureKeyboardMode(true), {passive:true});
}

function openModal(overlay){
  if(!overlay) return;
  state.modalOpen = true;
  overlay.setAttribute("aria-hidden","false");
  updateKeyboardEnabledState();
}
function closeModal(overlay){
  if(!overlay) return;
  overlay.setAttribute("aria-hidden","true");
  state.modalOpen = false;
  updateKeyboardEnabledState();
}
</script>
</body>
</html>
