<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>Trigrams for Grandma</title>
  <!-- Preload modal images -->
<link rel="preload" as="image" href="demo_clue.png">
<link rel="preload" as="image" href="demo_grid.gif">
<link rel="preload" as="image" href="question-mark.svg">
<link rel="preload" as="image" href="stats-icon.svg">


<style>
  :root{
    --bg:#a9cdf3;
    --bubble:#fff;
    --ink:#0b0b0b;

    --w1:#fff3b3;   /* yellow */
    --w2:#cfe8ff;   /* blue */
    --ol:#c9f3d6;   /* green overlap */
    --bad:#ffc9d2;  /* red/pink warning */
    --submit:#F4D2FD;

    --kb-h:260px;
    --caret:rgba(0,0,0,.18);

    --clue-hint-gap:7px;
    --lift-msg:38px;
    --lift-hints:96px;
    --msg-drop:35px;
    --result-drop:32px;
    --badge-drop:72px;
  }

  *{ box-sizing:border-box; }

  html,body{
    height:100%;
    overflow:hidden;
    overscroll-behavior:none;
    background:var(--bg);
  }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--ink);
    text-align:center;
    -webkit-text-size-adjust:100%;
  }

/* prevent selection / tap highlight inside the app */
:is(.wrap,#wrap,#rotateOverlay,#hintsModal,#kbHost,.kbHost),
:is(.wrap,#wrap,#rotateOverlay,#hintsModal,#kbHost,.kbHost) *{
  -webkit-user-select:none;
  user-select:none;
  -webkit-touch-callout:none;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}

  html.has-kb, html.has-kb body{
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}

html.has-kb .kbKey, 
html.has-kb .kbKey *{
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
  -webkit-user-drag:none;
  -webkit-tap-highlight-color:transparent;
}



  /* Smooth dim/blur transitions for main content + keyboard */
  :is(#wrap,.wrap,#kbHost,.kbHost){
    transition:filter .1s ease, opacity .1s ease;
  }



  /* ===== Layout ===== */
  :is(.wrap,#wrap){
    height:100dvh;
    max-height:100dvh;
    width:100%;
    max-width:980px;
    margin:0 auto;
    padding:12px 14px 14px;
    display:flex;
    flex-direction:column;
    align-items:stretch;
    justify-content:flex-start;
    overflow:hidden;
    position:relative;
  }

  .toprow{
    display:flex;
    justify-content:center;
    align-items:center;
    margin-top:2px;
    flex:0 0 auto;
  }

  .modePill{
    position:absolute;
    top:10px;
    right:14px;
    padding:4px 9px;
    border-radius:999px;
    font-size:11px;
    letter-spacing:.12em;
    text-transform:uppercase;
    background:rgba(255,255,255,.34);
    border:1px solid rgba(0,0,0,.12);
    color:rgba(0,0,0,.68);
    font-weight:700;
    opacity:.85;
    pointer-events:auto;
    cursor:pointer;
  }


  /* Top-left icon buttons */
  .statsBtn,
  .helpBtn{
    position:absolute;
    top:10px;
    width:28px;
    height:28px;
    border-radius:999px;
    padding:0;
    margin:0;
    background:rgba(255,255,255,.34);
    border:1px solid rgba(0,0,0,.12);
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    appearance:none;
    -webkit-appearance:none;
    outline:none;
    box-shadow:none;
  }
  .statsBtn{ left:14px; }
  .helpBtn{ left:48px; }

  .statsBtn:focus,
  .helpBtn:focus{
    outline:none;
    box-shadow:none;
  }
  .statsBtn:active,
  .helpBtn:active{
    transform:translateY(1px);
  }

  .statsIcon,
  .helpIcon{
    width:17px;
    height:17px;
    opacity:.50;
    display:block;
    pointer-events:none;
  }


  .nav{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:850;
  }
  .nav :is(a,button){
    color:var(--ink);
    text-decoration:none;
    font-weight:850;
    padding:5px 10px;
    border-radius:999px;
    background:rgba(255,255,255,.32);
    border:1.5px solid rgba(0,0,0,.16);
    cursor:pointer;
    appearance:none;
    -webkit-appearance:none;
    font:inherit;
  }
  .nav :is(a,button):active{ transform:translateY(1px); }
    .nav a.is-disabled{
    opacity:.35;
    pointer-events:none;
    cursor:default;
  }



.nav .navCaret{
  display:inline-block;
  position:relative;
  opacity:0.5;
  top:-1px; 
}


  .count{
    font-weight:850;
    opacity:.6;
    min-width:58px;
    text-align:center;
  }

  /* ===== Clue + floating hint track ===== */
  .clue{
    display:block;
    width:fit-content;
    max-width:min(940px,94vw);
    margin:clamp(18px,3.6vh,36px) auto 0;
    padding:14px 13px 15px 20px;
    background:var(--bubble);
    border-radius:18px;
    box-shadow:0 2px 6px rgba(0,0,0,.08);
    font-size:clamp(30px,5.4vw,38px);
    line-height:1.12;
    letter-spacing:.12px;
    font-weight:400;
    flex:0 0 auto;
  }

  /* ===== Assist activation flash (clue glow) ===== */
  .clue.assist-glow{ animation:assistClueGlow 3.2s ease-out both; }
  @keyframes assistClueGlow{
    0%{
      box-shadow:
        0 2px 6px rgba(0,0,0,.08),
        0 0 0 4px rgba(70,255,150,.95),
        0 0 40px rgba(70,255,150,.75);
    }
    55%{
      box-shadow:
        0 2px 6px rgba(0,0,0,.08),
        0 0 0 4px rgba(70,255,150,.72),
        0 0 54px rgba(70,255,150,.6);
    }
    100%{
      box-shadow:
        0 2px 6px rgba(0,0,0,.08),
        0 0 0 0 rgba(70,255,150,0),
        0 0 0 rgba(70,255,150,0);
    }
  }

  /* ===== Assist activation flash (message) ===== */
  .msg.assistFlash{ animation:assistMsgFlash 4.2s ease-in-out both; }
  @keyframes assistMsgFlash{
    0%   { opacity:0;   transform:translateX(-50%) translateY(-6px); }
    12%  { opacity:.92; transform:translateX(-50%) translateY(0); }
    75%  { opacity:.92; transform:translateX(-50%) translateY(0); }
    100% { opacity:0;   transform:translateX(-50%) translateY(10px); }
  }

  .clue .len{
    opacity:.55;
    display:inline-block;
    font-size:.92em;
    line-height:1;
    vertical-align:middle;
    position:relative;
    top:-0.1em;
    margin-left:8px;
  }

  .clueWrap{
    position:relative;
    flex:0 0 auto;
    padding-bottom:0;
  }
  .clueWrap.hasTopTrack{ padding-bottom:15px; }

  .hintTrackTop{
    position:absolute;
    left:50%;
    top:calc(100% + var(--clue-hint-gap));
    transform:translateX(-50%);
    margin:0;
    min-height:0;
    z-index:30;
  }

  .clueWord{
    display:inline-block;
    cursor:pointer;
    font-kerning:none;
    font-variant-ligatures:none;
    font-feature-settings:"kern" 0,"liga" 0,"clig" 0;
  }

  .u-w1,.u-w2,.u-red{
    text-decoration:underline;
    text-decoration-thickness:6px;
    text-underline-offset:9px;
    pointer-events:none;
  }
  .u-w1{ text-decoration-color:rgba(255,220,0,.9); }
  .u-w2{ text-decoration-color:rgba(70,160,255,.92); }
  .u-red{ text-decoration-color:rgba(235,80,92,.92); }

  /* ===== Grid ===== */
  :is(.gridDock,#gridDock){
    display:block;
    width:fit-content;
    margin:105px auto 0;
    position:relative;
    flex:0 0 auto;
    border-radius:14px;
    box-shadow:0 3px 8px rgba(0,0,0,.08);
    transition:box-shadow .45s ease;
    will-change:transform,box-shadow;
    z-index:20;
    isolation:isolate;
  }
  @media (pointer:coarse) and (max-width:920px){
    :is(.gridDock,#gridDock){ margin-top:clamp(36px,6.1vh,62px); }
  }
  html.has-kb :is(.gridDock,#gridDock){ margin:90px auto 0; }
  :is(.gridDock,#gridDock).shake{ animation:shake .16s linear 0s 2; }

  .wrap.solved:not(.gaveup) :is(.gridDock,#gridDock),
  .wrap.gaveup :is(.gridDock,#gridDock){
    pointer-events:none;
    transform:translate3d(0,-16px,0) scale(1.01);
    box-shadow:0 14px 26px rgba(0,0,0,.14);
    animation:solvedPop .46s ease-out both;
  }
  .wrap.solved:not(.gaveup) :is(.gridDock,#gridDock){
    box-shadow:
      0 0 0 7px rgba(200,247,210,.55),
      0 0 0 13px rgba(200,247,210,.22),
      0 14px 26px rgba(0,0,0,.14);
    animation:solvedPop .46s ease-out both, glowPulse 1.15s ease-in-out 0s 2;
  }
  .wrap.gaveup :is(.gridDock,#gridDock){
    box-shadow:
      0 0 0 7px rgba(255,150,160,.46),
      0 0 0 13px rgba(255,150,160,.20),
      0 14px 26px rgba(0,0,0,.14);
    animation:solvedPop .46s ease-out both, redPulse 1.15s ease-in-out 0s 2;
  }

  @keyframes solvedPop{
    0%{ transform:translate3d(0,-10px,0) scale(.985); }
    55%{ transform:translate3d(0,-20px,0) scale(1.02); }
    100%{ transform:translate3d(0,-16px,0) scale(1.01); }
  }
  @keyframes glowPulse{
    0%{
      box-shadow:
        0 0 0 7px rgba(200,247,210,.40),
        0 0 0 13px rgba(200,247,210,.16),
        0 14px 26px rgba(0,0,0,.14);
    }
    50%{
      box-shadow:
        0 0 0 7px rgba(200,247,210,.70),
        0 0 0 14px rgba(200,247,210,.28),
        0 16px 30px rgba(0,0,0,.16);
    }
    100%{
      box-shadow:
        0 0 0 7px rgba(200,247,210,.55),
        0 0 0 13px rgba(200,247,210,.22),
        0 14px 26px rgba(0,0,0,.14);
    }
  }
  @keyframes redPulse{
    0%{
      box-shadow:
        0 0 0 7px rgba(255,150,160,.32),
        0 0 0 13px rgba(255,150,160,.12),
        0 14px 26px rgba(0,0,0,.14);
    }
    50%{
      box-shadow:
        0 0 0 7px rgba(255,150,160,.60),
        0 0 0 14px rgba(255,150,160,.24),
        0 16px 30px rgba(0,0,0,.16);
    }
    100%{
      box-shadow:
        0 0 0 7px rgba(255,150,160,.46),
        0 0 0 13px rgba(255,150,160,.20),
        0 14px 26px rgba(0,0,0,.14);
    }
  }
  @keyframes shake{
    0%{ transform:translateX(0); }
    25%{ transform:translateX(-6px); }
    50%{ transform:translateX(6px); }
    75%{ transform:translateX(-4px); }
    100%{ transform:translateX(0); }
  }

  :is(.gridWrap,#gridWrap){
    display:block;
    border:4px solid var(--ink);
    border-radius:14px;
    overflow:hidden;
    background:#fff;
  }

  .grid{
    --n:7;
    --gap:3px;
    --cell:44px;
    display:grid;
    grid-template-columns:repeat(var(--n),1fr);
    gap:var(--gap);
    background:var(--ink);
    width:min(calc(var(--n) * var(--cell) + (var(--n) - 1) * var(--gap)),92vw);
  }

  .cell{
    aspect-ratio:1/1;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#fff;
    position:relative;
  }

  .cell.active::after{
    content:"";
    position:absolute;
    height:3px;
    width:62%;
    left:50%;
    bottom:12%;
    transform:translateX(-50%);
    background:var(--caret);
    border-radius:999px;
    animation:caretBlink 1.1s steps(2,end) infinite;
    pointer-events:none;
    opacity:1;
  }
  @keyframes caretBlink{
    0%,46%{ opacity:1; }
    47%,100%{ opacity:0; }
  }

  .cell input{
    width:100%;
    height:100%;
    border:0;
    outline:none;
    background:transparent;
    text-align:center;
    font-size:clamp(23px,5.1vw,32px);
    font-weight:900;
    font-style:italic;
    padding:0;
    margin:0;
    color:var(--ink);
    text-transform:lowercase;
    caret-color:transparent;
    cursor:text;
    appearance:none;
    -webkit-appearance:none;
    border-radius:0;
    user-select:none;
    -webkit-user-select:none;
  }
  .cell input::selection{ background:transparent; color:inherit; }


  .cell.bg-bad{ background:var(--bad) !important; }

  

  html.has-kb .cell input{ pointer-events:none; }

  /* ===== Messages ===== */
  :is(.msgSlot,#msgSlot){
    position:relative;
    height:78px;
    width:100%;
    max-width:760px;
    margin:clamp(2px,.7vh,6px) auto 0;
    flex:0 0 auto;
    pointer-events:none;
    transform:translateY(calc(-1 * var(--lift-msg) + var(--msg-drop)));
  }
  .wrap.solved :is(.msgSlot,#msgSlot){ margin-top:clamp(0px,.4vh,4px); }

  .msg{
    position:absolute;
    left:50%;
    top:18px;
    margin:0;
    font-weight:900;
    opacity:0;
    transition:opacity .18s ease, transform .18s ease;
    font-style:italic;
    font-size:22px;
    pointer-events:none;
    width:max-content;
    max-width:min(92vw,760px);
    white-space:pre-line;
    line-height:1.15;
    text-align:center;
    transform:translateX(-50%) translateY(0);
    padding-right: 0.25em; 
  margin-right: -0.25em; 
  box-sizing: content-box;
  }
  .msg.show{ opacity:.92; }
  .msg.warn{ opacity:.92; font-size:20px; }
  .msg.result{
    top:12px;
    font-size:27px;
    transform:translateX(-50%) translateY(calc(var(--result-drop) - var(--msg-drop)));
  }

  .msg .msgLine{ display:block; }
  .msg.result .msgLine.score{ font-size:26px; margin-top:6px; }
  .msg.result .msgLine.meta{ font-size:14px; opacity:.55; margin-top:4px; }

 


  html.has-kb .hintDockBottom{
    position:fixed;
    left:0; right:0;
    bottom:calc(
      var(--kb-h) + env(safe-area-inset-bottom) + 36px
      + var(--btn-row-h, 0px) + 22px
    );
    margin:0;
    z-index:9996;
  }

  .trackRow{
    display:flex;
    align-items:flex-start;
    justify-content:center;
    gap:18px;
    flex-wrap:nowrap;
    transition:opacity .35s ease;
  }

  .trackBlock{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    min-width:0;
  }

  .letters{
    display:inline-flex;
    background:transparent;
    position:relative;
    flex:0 0 auto;
  }
  .letters.clickable{ cursor:pointer; }

  .letter{
    width:29px;
    height:29px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    font-style:italic;
    font-size:19px;
    text-transform:lowercase;
    background:rgba(255,255,255,.35);
    transition:opacity .15s ease, background .15s ease, transform .08s ease;
    border:1px solid rgba(0,0,0,.22);
    transform-origin:center;
  }
  .letter + .letter{ margin-left:-1px; }

  .letter.sel-w1{ background:var(--w1); }
  .letter.sel-w2{ background:var(--w2); }

  .letter.extra{
    background:rgba(255,255,255,.95);
    cursor:pointer;
    box-shadow:none;
  }
  .letter.extra:active{ transform:translateY(1px); }

  .extrasRow{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:center;
    flex-wrap:nowrap;
  }

  .letters.is-in-grid .letter{ opacity:.38; }
  #trackBox-extras .letter.is-in-grid{ opacity:.38; }

  /* ===== Hint fly overlay ===== */
  .hintSpotOverlay{
    position:fixed;
    inset:0;
    z-index:12000;
    pointer-events:none;
    display:block;
  }
  .hintSpot{
    position:fixed;
    left:50%;
    top:42%;
    transform:translate(-50%,-50%);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    will-change:transform,filter,opacity;
  }
  .hintSpot.h1 .letter{ background:var(--w1); }
  .hintSpot.h2 .letter{ background:var(--w2); }
  .hintSpot.hex .letter{ background:rgba(255,255,255,.97); }

  /* ===== Skill dock + badge ===== */
  :is(.skillDock,#skillDock){
    margin:clamp(0px,.5vh,6px) auto 0;
    width:fit-content;
    max-width:min(920px,96vw);
    min-height:74px;
    display:flex;
    align-items:center;
    justify-content:center;
    flex:0 0 auto;
    position:relative;
    transform:translateY(calc(-1 * var(--lift-hints)));
  }

  .wrap.solved .trackRow{ opacity:0; }
  .wrap.solved .hintTrack{ pointer-events:none; opacity:1; }

  .skillBadge{
    position:absolute;
    left:50%;
    top:40%;
    transform:translate(-50%,-50%) translateY(var(--badge-drop)) scale(.84);
    opacity:0;
    pointer-events:none;
    transition:opacity .35s ease, transform .35s ease;
  }
.wrap.solved .skillBadge{
  opacity:1;
  transform:translate(-50%,-50%) translateY(var(--badge-drop)) scale(.86);
  transition-delay:.06s;
  pointer-events:auto;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}


    .nextPuzzleBtn{
    position:absolute;
    left:50%;
    top:40%;

    /* increase this number for a bigger gap under the badge */
    --next-y: calc(var(--badge-drop) + 120px);

    transform:translate(-50%,-50%) translateY(var(--next-y));
    opacity:0;
    visibility:hidden;
    pointer-events:none;

    border:3.5px solid var(--ink);
    border-radius:999px;
    padding:9px 16px;
    min-width:190px;
    font-size:16px;
    font-weight:900;
    color:var(--ink);
    background:rgba(255,255,255,.35);
    cursor:pointer;
    text-transform:uppercase;
    letter-spacing:.12em;
    appearance:none;
    -webkit-appearance:none;
    box-shadow:0 7px 0 rgba(0,0,0,.16);
    transition:opacity .35s ease, transform .35s ease;
  }

  .nextPuzzleBtn:active{
    transform:translate(-50%,-50%) translateY(calc(var(--next-y) + 1px));
    box-shadow:0 6px 0 rgba(0,0,0,.16);
  }

  /* show it only once the answer is revealed (solved OR gave up) */
  .wrap.solved .nextPuzzleBtn,
  .wrap.gaveup .nextPuzzleBtn{
    opacity:1;
    visibility:visible;
    pointer-events:auto;
    transition-delay:.10s;
  }

  /* only apply disabled styling once it‚Äôs actually visible */
  .wrap.solved .nextPuzzleBtn:disabled,
  .wrap.gaveup .nextPuzzleBtn:disabled{
    opacity:.35;
    cursor:default;
    pointer-events:none;
  }

  .skillBadgeInner{
    position:relative;
    overflow:hidden;
    min-width:120px;
    padding:10px 14px;
    border-radius:16px;
    text-align:center;

    --txt:#2a1a00;
    --bdr:rgba(255,220,130,.65);
    --g1:rgba(255,235,180,.95);
    --g2:rgba(255,200,90,.92);
    --g3:rgba(255,240,200,.96);
    --g4:rgba(255,190,70,.92);

    color:var(--txt);
    border:1px solid var(--bdr);
    background:linear-gradient(135deg,var(--g1) 0%,var(--g2) 35%,var(--g3) 70%,var(--g4) 100%);
    box-shadow:
      0 12px 26px rgba(255,200,80,.16),
      0 3px 10px rgba(0,0,0,.22);
  }

  .skillBadgeInner.gold{
    --txt:#2a1a00;
    --bdr:rgba(255,220,130,.70);
    --g1:rgba(255,238,190,.96);
    --g2:rgba(255,205,105,.94);
    --g3:rgba(255,246,210,.97);
    --g4:rgba(255,185,70,.93);
    box-shadow:
      0 14px 28px rgba(255,205,95,.18),
      0 3px 10px rgba(0,0,0,.22);
  }

  .skillBadgeInner.silver{
    --txt:#1f2328;
    --bdr:rgba(200,206,215,.70);
    --g1:rgba(238,242,247,.99);
    --g2:rgba(214,222,232,.96);
    --g3:rgba(242,246,250,.99);
    --g4:rgba(203,212,223,.95);
    box-shadow:
      0 12px 24px rgba(0,0,0,.12),
      0 3px 10px rgba(0,0,0,.20);
  }

  .skillBadgeInner.bronze{
    --txt:#2a1204;
    --bdr:rgba(190,130,95,.46);
    --g1:rgba(248,214,190,.99);
    --g2:rgba(226,170,130,.96);
    --g3:rgba(250,222,205,.99);
    --g4:rgba(208,150,112,.95);
    box-shadow:
      0 12px 24px rgba(0,0,0,.12),
      0 3px 10px rgba(0,0,0,.20);
  }

  .skillBadgeInner.red{
    --txt:#160405;
    --bdr:rgba(150,55,60,.42);
    --g1:rgba(242,208,208,.99);
    --g2:rgba(220,150,148,.96);
    --g3:rgba(244,214,214,.99);
    --g4:rgba(195,120,120,.95);
    box-shadow:
      0 14px 28px rgba(0,0,0,.14),
      0 3px 10px rgba(0,0,0,.20);
  }

  .skillBadgeLabel{
    font-size:12px;
    font-weight:900;
    letter-spacing:.14em;
    text-transform:uppercase;
    opacity:.75;
  }
  .skillBadgeValue{
    font-size:34px;
    font-weight:950;
    line-height:1;
    margin-top:2px;
    text-shadow:0 1px 0 rgba(255,255,255,.45);
  }

  .skillBadgeInner::before{
    content:"";
    position:absolute;
    inset:0;
    border-radius:inherit;
    background:
      radial-gradient(circle at 18% 28%, rgba(255,255,255,.85), transparent 38%),
      radial-gradient(circle at 78% 42%, rgba(255,255,255,.55), transparent 42%),
      radial-gradient(circle at 54% 86%, rgba(255,255,255,.35), transparent 48%);
    opacity:.55;
    pointer-events:none;
  }
  .skillBadgeInner::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:inherit;
    pointer-events:none;
    background:linear-gradient(110deg,
      transparent 0%,
      rgba(255,255,255,0) 38%,
      rgba(255,255,255,.70) 48%,
      rgba(255,255,255,0) 60%,
      transparent 100%);
    background-size:220% 100%;
    background-position:-120% 0;
    opacity:.55;
    mix-blend-mode:soft-light;
    animation:skillShine 1.6s ease-in-out infinite;
  }
  @keyframes skillShine{
    0%{ background-position:-120% 0; opacity:0; }
    15%,55%{ opacity:.55; }
    100%{ background-position:120% 0; opacity:0; }
  }
  @media (prefers-reduced-motion:reduce){
    .skillBadgeInner::after{ animation-duration:4.5s; opacity:.25; }
  }

  /* ===== Buttons ===== */
  :is(.btnRow,#btnRow){
    margin-top:clamp(18px,3.8vh,26px);
    display:flex;
    justify-content:center;
    gap:12px;
    flex-wrap:wrap;
    flex:0 0 auto;
    padding-bottom:2px;
    transition:opacity .35s ease, transform .35s ease;
  }

  .wrap.solved :is(#btnRow,.btnRow){
    opacity:0;
    transform:translateY(6px);
    pointer-events:none;
  }
  .wrap.solved .hintTrackTop{ opacity:0; pointer-events:none; }

  .btn{
    border:4px solid var(--ink);
    border-radius:999px;
    padding:9px 16px;
    min-width:104px;
    font-size:20px;
    font-weight:900;
    font-style:italic;
    color:var(--ink);
    background:rgba(255,255,255,.35);
    cursor:pointer;
    text-transform:lowercase;
    appearance:none;
    -webkit-appearance:none;
    box-shadow:0 7px 0 rgba(0,0,0,.16);
  }
  .btn:active{ transform:translateY(1px); box-shadow:0 6px 0 rgba(0,0,0,.16); }
  .btn.hints{ background:#fff3bd; }
  .btn.check{ background:rgba(255,255,255,.25); opacity:.55; }
  .btn.check.ready{ opacity:1; background:var(--submit); }
  .btn:disabled{
    opacity:.35 !important;
    cursor:default;
    transform:none !important;
    box-shadow:0 7px 0 rgba(0,0,0,.10);
  }

  html.has-kb :is(.btnRow,#btnRow){
    position:fixed;
    left:0; right:0;
    bottom:calc(var(--kb-h) + env(safe-area-inset-bottom) + 36px);
    margin:0;
    z-index:9997;
  }
  html.has-kb .btn{ border-width:3px; }

  
  /* ===== Keyboard ===== */
:is(.kbHost,#kbHost){
  position:fixed;
  left:0; right:0;
  bottom:0;
  z-index:9996;
  display:none;
  padding:10px 10px calc(22px + env(safe-area-inset-bottom));
  background:rgba(255,255,255,.90);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-top:2px solid rgba(0,0,0,.14);
  touch-action:none;
}

    html.has-kb :is(.kbHost,#kbHost){ display:block; }

  /* hide custom keyboard once the answer is revealed */
  #wrap.solved ~ :is(.kbHost,#kbHost),
  #wrap.gaveup ~ :is(.kbHost,#kbHost){
    display:none !important;
  }


  .kb{
    max-width:560px;
    margin:0 auto;
    display:flex;
    flex-direction:column;
    gap:8px;
    --keyW:clamp(28px,8.6vw,48px);
  }
  .kbRow{ display:flex; justify-content:center; gap:4px; }

  .kbKey{
    width:var(--keyW);
    height:48px;
    border:2px solid rgba(0,0,0,.16);
    border-radius:11px;
    background:rgba(255,255,255,.82);
    font-weight:700;
    font-style:normal;
    text-transform:none;
    font-size:18px;
    color:var(--ink);
    cursor:pointer;
        -webkit-touch-callout:none;
    -webkit-user-select:none;
    user-select:none;

  }
  .kbKey:active{ transform:translateY(1px); }

  .kbKey .kbIcon{
    width:24px;
    height:24px;
    display:block;
    margin:0 auto;
    pointer-events:none;
    user-select:none;
    -webkit-user-drag:none;
  }

  .kbKey.wide{ width:calc(var(--keyW) * 1.55); font-size:12px; font-weight:900; letter-spacing:.08em; padding:0; }
  .kbKey.enter{ font-size:11px; letter-spacing:.02em; }
  .kbKey.enter:not(.is-disabled){ background:rgba(0,0,0,.07); }

  .kbKey.delete{
    font-size:16.3px;
    letter-spacing:.03em;
    font-weight:750;
    background:rgba(0,0,0,.07);
  }
  .kbKey.reset{
    font-size:13px;
    color:rgba(0,0,0,.6);
    letter-spacing:.01em;
    font-weight:700;
    background:rgba(0,0,0,.07);
  }

  .kbKey.is-disabled{
    opacity:.38;
    background:rgba(0,0,0,.04);
    border-color:rgba(0,0,0,.10);
    transform:none !important;
    cursor:default;
  }

/* ===== Modal + Stats overlay (shared) ===== */
  :is(.modalOverlay,.statsOverlay){
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.26);
    display:none;
    align-items:flex-start;  /* anchor cards near top */
    justify-content:center;
    padding:
      max(48px, env(safe-area-inset-top) + 65px) /* fixed-ish top gap */
      14px
      14px;
  }
  .modalOverlay{ z-index:10000; }
  .statsOverlay{ z-index:11000; }
  :is(.modalOverlay,.statsOverlay).open{ display:flex; }


  :is(.modalCard,.statsCard){
    width:min(420px,94vw);
    max-height:75vh;                 /* cap at 75% of viewport height */
    background:#fff;
    border-radius:18px;
    border:2px solid rgba(0,0,0,.15);
    box-shadow:0 10px 26px rgba(0,0,0,.18);
    overflow:hidden;                 /* header fixed, body scrolls */
    text-align:left;
    display:flex;                    /* header + body as flex column */
    flex-direction:column;
  }


:is(.modalHdr,.statsHdr){
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid rgba(0,0,0,.08);
  gap:10px;
}
.modalHdr{ padding:14px 14px 12px; }
.statsHdr{ padding:14px 14px 10px; }


  .modalTitle,
  .statsTitle{
    font-weight:950;
    font-size:18px;
    letter-spacing:.01em;
  }
  .modalTitle{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  :is(.modalX,.statsX){
    border:0;
    background:transparent;
    color:var(--ink);
    font-size:20px;
    line-height:1;
    font-weight:300;
    cursor:pointer;
    padding:2px 6px;
    opacity:.9;
    outline:none !important;
    box-shadow:none !important;
    appearance:none;
    -webkit-appearance:none;
  }
  :is(.modalX,.statsX):active{ transform:translateY(1px); }

:is(.modalBody,.statsBody){
  padding:12px 14px 14px;
  flex:1 1 auto;
  min-height:0;
  overflow:auto;
}
.statsBody{ font-size:14px; }



  .statsIntro{ margin-bottom:10px; font-size:13px; opacity:.8; }
  .statsSection{ margin-bottom:14px; }
  .statsSection h3{ margin:0 0 4px; font-size:15px; }
  .statsSummary{ margin:0 0 6px; font-size:13px; opacity:.85; }
  .statsCols{ display:flex; gap:10px; flex-wrap:wrap; }
  .statsCol{ flex:1 1 0; min-width:0; }
  .statsCol h4{
    margin:0 0 4px;
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:.09em;
    opacity:.7;
  }

    .helpModeLink{
    margin-top:8px;
  }

  .linkBtn{
    border:0;
    padding:0;
    margin:0;
    background:none;
    color:#1a4ed8;
    font:inherit;
    text-decoration:underline;
    cursor:pointer;
  }
  .linkBtn:active{
    transform:translateY(1px);
  }


  .statRow{ display:flex; align-items:center; gap:6px; margin-bottom:3px; }
  .statLabel{ flex:0 0 64px; font-size:12px; opacity:.8; }
  .statBar{
    flex:1 1 auto;
    height:7px;
    border-radius:999px;
    background:rgba(0,0,0,.06);
    overflow:hidden;
  }
  .statBarFill{
    display:block;
    height:100%;
    border-radius:999px;
    background:linear-gradient(90deg, rgba(40,120,255,.9), rgba(110,200,255,.9));
  }
  .statValue{ flex:0 0 auto; min-width:18px; text-align:right; font-size:12px; }
  .statsEmpty{ margin:0 0 4px; font-size:13px; opacity:.75; }

  /* Dim + blur main content + keyboard whenever a modal/stats overlay is open */
  body:has(.modalOverlay.open) :is(#wrap,.wrap,#kbHost,.kbHost),
  body:has(.statsOverlay.open) :is(#wrap,.wrap,#kbHost,.kbHost){
    filter:blur(1px) brightness(0.9);
    opacity:.65;
  }


  
  /* ===== Rotate overlay ===== */
  #rotateOverlay{
    display:none;
    position:fixed;
    inset:0;
    z-index:25000;
    background:rgba(169,205,243,.98);
    padding:
      calc(18px + env(safe-area-inset-top))
      16px
      calc(18px + env(safe-area-inset-bottom));
    align-items:center;
    justify-content:center;
    text-align:center;
  }
  #rotateOverlay .card{
    width:min(560px,92vw);
    background:rgba(255,255,255,.92);
    border:2px solid rgba(0,0,0,.16);
    border-radius:18px;
    padding:18px 16px;
    box-shadow:0 10px 26px rgba(0,0,0,.18);
  }
  #rotateOverlay .title{
    margin:0 0 8px;
    font-weight:600;
    font-style:normal;
    font-size:16px;
    line-height:1.2;
    opacity:.78;
  }
  #rotateOverlay .body{
    margin:0;
    font-weight:950;
    font-size:24px;
    line-height:1.15;
  }
  #rotateOverlay .body b{ font-weight:inherit; }

  @media (pointer:coarse) and (orientation:landscape) and (max-height:430px){
    #rotateOverlay{ display:flex; }
    :is(#wrap,.wrap){ pointer-events:none; opacity:.25; filter:blur(2px); }
    :is(#kbHost,.kbHost){ display:none !important; }
  }

  /* ===== Mobile tweaks ===== */
  @media (max-width:520px){
    :root{ --lift-msg:34px; --lift-hints:88px; }

    .nav :is(a,button){ padding:4px 9px; }

    .clue{
      font-size:clamp(33px,6.9vw,39px);
      margin-top:clamp(16px,3.4vh,28px);
    }

    .grid{
      --cell:43px;
      width:min(calc(var(--n) * var(--cell) + (var(--n) - 1) * var(--gap)),94vw);
    }
    .cell input{ font-size:clamp(24px,6.05vw,36px); }
    .letter{ width:28px; height:28px; font-size:19px; }

    .msgSlot{ height:84px; }
    .msg{ top:12px; font-size:20px; }
    .msg.warn{ font-size:19px; }
    .msg.result{ top:14px; font-size:25px; }

    .btn{ font-size:19px; padding:9px 15px; min-width:98px; }
    .kbKey{ height:46px; }
    .hintSpot{ top:40%; }

    .modePill{ top:8px; right:10px; font-size:10px; padding:3px 8px; }
    .statsBtn{ left:10px; top:8px; width:26px; height:26px; }
    .helpBtn{ left:44px; top:8px; width:26px; height:26px; }
  }

  @media (min-width:600px){
    .modePill{ right:calc(50% - 300px + 12px); }
    .statsBtn{ left:calc(50% - 300px + 12px); }
    .helpBtn{ left:calc(50% - 300px + 46px); }
  }


  /* Stats overlay typography boost */
.statsTitle{
  font-size: 1.4rem;         /* bigger, ‚Äúheadliney‚Äù */
  font-weight: 700;
}

.statsSection h3{
  font-size: 1.05rem;
  font-weight: 600;
}

.statsSummary{
  font-size: 0.98rem;        /* up from typical body size */
  line-height: 1.45;
}

.statsEmpty,
.statsIntro{
  font-size: 0.95rem;
  line-height: 1.5;
}


.statsModes{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:2px;
}

.statsSection{
  margin:0;
  padding:9px 11px 9px;
  border-radius:12px;
  background:rgba(0,0,0,.03);
  border:1px solid rgba(0,0,0,.06);
}

.statsSection-empty{
  background:transparent;
  border-style:dashed;
  border-color:rgba(0,0,0,.14);
}

.modeHeading{
  margin:0 0 6px;
  font-size: 1.4rem;     
  font-weight: 700;
  display:flex;
  align-items:baseline;
  gap:4px;
}

.modeMeta{
  font-size:0.80rem;
  font-weight:500;
  opacity:.72;
}

.modeLine{
  margin:1px 0;
  font-size:0.9rem;
  display:flex;
  gap:6px;
}

.modeLabel{
  flex:0 0 170px; /* wider so "Longest 0-hint streak:" stays on one line */
  font-weight:600;
  opacity:.78;
}

.modeValue{
  flex:1 1 auto;
}

.modeLine-muted,
.modeValue-muted{
  color:rgba(0,0,0,.40);
  opacity:.9;
}

.statsEmpty{
  margin:4px 0 2px;
  font-size:0.9rem;
  color:rgba(0,0,0,.55);
}
.helpDemos{
  max-width:500px;
  margin:10px auto 10px;
}
.helpDemos img{
  display:block;
  width:75%;
  height:auto;
  margin:0 auto;          
}

.helpDemos img + img{ margin-top:8px; }
  
</style>



</head>

<body>
  <div class="wrap" id="wrap">

       <!-- Stats button -->
    <button class="statsBtn" id="statsBtn" type="button" aria-label="Show stats">
      <img src="stats-icon.svg" alt="" class="statsIcon">
    </button>

    <!-- How-to-play button -->
    <button class="helpBtn" id="helpBtn" type="button" aria-label="How to play">
      <img src="question-mark.svg" alt="" class="helpIcon">
    </button>
    
    <div class="toprow">
    <div class="nav">
  <a href="#" id="prevBtn" aria-label="Previous puzzle">
    <span class="navCaret">‚Äπ</span>
  </a>
  <span class="count" id="count"></span>
  <a href="#" id="nextBtn" aria-label="Next puzzle">
    <span class="navCaret">‚Ä∫</span>
  </a>
</div>

    </div>
<div class="modePill" id="modePill" aria-label="Mode: Classic">Classic</div>
    
     <div class="clueWrap" id="clueWrap">
    <div class="clue" id="clue"></div>

    <!-- floating hint track UNDER the clue -->
    <div class="hintTrack hintTrackTop" id="hintTrack" aria-label="Hint tracker">
      <div class="trackRow" id="trackRow">
        <div class="trackBlock" id="trackW1"></div>
        <div class="trackBlock" id="trackW2"></div>
        <div class="trackBlock" id="trackExtras"></div>
      </div>
    </div>
  </div>

  <div class="gridDock" id="gridDock">
    <div class="gridWrap" id="gridWrap" aria-label="Answer grid">
      <div class="grid" id="grid" style="--n:7"></div>
    </div>
  </div>

  <div class="msgSlot" id="msgSlot" aria-live="polite">
    <div class="msg" id="msg"></div>
  </div>

<!-- Skill badge  -->
  <div class="skillDock" id="skillDock" aria-label="Skill badge">
    <div class="skillBadge" id="skillBadge" aria-hidden="true">
      <div class="skillBadgeInner">
        <div class="skillBadgeLabel">Skill</div>
        <div class="skillBadgeValue" id="skillBadgeValue">‚Äî</div>
      </div>
    </div>

    <button class="nextPuzzleBtn" id="nextPuzzleBtn" type="button" aria-label="Next puzzle">NEXT PUZZLE</button>
  </div>

  <!-- bottom hint-track dock (we move #hintTrack here when there‚Äôs room) -->
  <div class="hintDockBottom" id="hintDockBottom"></div>

  <div class="btnRow" id="btnRow">
    <button class="btn hints" id="hintsBtn" type="button">hint 1</button>
    <button class="btn check" id="checkBtn" type="button">check</button>
  </div>
</div>


  <div class="modalOverlay" id="hintsModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="hintsModalTitle">
      <div class="modalHdr">
        <div class="modalTitle" id="hintsModalTitle">Choose a hint</div>
        <button class="modalX" id="hintsModalClose" type="button" aria-label="Close">√ó</button>
      </div>
      <div class="modalBody" id="hintsModalBody"></div>
    </div>
  </div>
<!-- How to play modal -->
<div class="modalOverlay" id="helpOverlay" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modalHdr">
      <div class="modalTitle" id="helpTitle">How to play</div>
      <button class="modalX" id="helpClose" type="button" aria-label="Close how to play">√ó</button>
    </div>
    <div class="modalBody" id="helpBody">
      <p>
        Each puzzle has <strong>two clue words</strong> and a
        <strong>unique 7-letter answer word</strong>.
      </p>
      <p>
        The answer word must contain <strong>one 3-letter chunk</strong> (a
        <em>trigram</em>) from <strong>each clue word</strong>.
         </p>
      <p>
        The two trigrams may <strong>overlap by 1-letter</strong>, so you‚Äôll need
        <strong>1 or 2 extra letters</strong> to make the word.
      </p>
            <div class="helpDemos" aria-label="Demo images">
        <img src="demo_grid.gif" alt="Grid demo" loading="eager" decoding="async">
      </div>

      <p>
        Maximise your <strong>skill score</strong> by taking fewer hints, less time and less wrong guesses!
      </p><hr style="border:0; height:1px; background:rgba(0,0,0,.1); margin:14px 0 16px;">


<p class="helpModeLink">
  One mode for now: type the 7-letter answer, then press <b>check</b>.
</p>

    </div>
  </div>
</div>


  <!-- Mode info modal -->
  <div class="modalOverlay" id="modeOverlay" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
      <div class="modalHdr">
                <div class="modalTitle" id="modeTitle">Game Modes</div>
        <button class="modalX" id="modeClose" type="button" aria-label="Close mode info">√ó</button>
      </div>
      <div class="modalBody" id="modeBody">
        <p>
          Puzzles always start in <strong>Classic mode</strong>. You have to do most of the thinking.
          You can still use hints and drag trigrams around the grid, but you can't quickly replace trigrams without typing.
        </p> <p><i>üß† Best mode to challenge your brain</i> </p><hr style="border:0; height:1px; background:rgba(0,0,0,.1); margin:14px 0 16px;">
        <p>
          <strong>Assisted mode</strong> <br><br>Simply tap a clue word at any time to turn this on for the current puzzle.
    
        </p>
        <ul>
          <li>Tap a clue word to add/replace trigrams</li>
          <li>Auto-highlighting of trigrams</li>
         
        </ul><p>  <i>üí° Best mode when you're feeling lazy</i> </p><hr style="border:0; height:1px; background:rgba(0,0,0,.1); margin:14px 0 16px;">
        <p>
          Your <strong>skill score</strong> and other stats will be tracked separately for Classic vs Assisted puzzle attempts to keep things fair.
        </p>
      </div>

    </div>
  </div>

  <div class="kbHost" id="kbHost" aria-label="On-screen keyboard"></div>


  <!-- Stats overlay -->
  <div class="statsOverlay" id="statsOverlay" aria-hidden="true">
    <div class="statsCard" role="dialog" aria-modal="true" aria-labelledby="statsTitle">
      <div class="statsHdr">
        <div class="statsTitle" id="statsTitle">Your stats</div>
        <button class="statsX" id="statsClose" type="button" aria-label="Close stats">√ó</button>
      </div>
      <div class="statsBody" id="statsBody"></div>
    </div>
  </div>

  <div id="rotateOverlay" aria-hidden="true">
    <div class="card" role="alert">
      <p class="body"><b>Please rotate your device.</b></p>
      <p class="title">Oops! We can't fit everything on your screen.</p>
    </div>
  </div>



<script>
/* =======================
   Puzzles
   ======================= */
const PUZZLES = [
{ clue:"Ample bounty", word1:"ample", word2:"bounty", answer:"aplenty", tri1:"ple", tri2:"nty" },
  { clue:"Vegans' picnic", word1:"vegans", word2:"picnic", answer:"organic", tri1:"gan", tri2:"nic" },
  { clue:"Wheezy groans", word1:"wheezy", word2:"groans", answer:"banshee", tri1:"hee", tri2:"ans" },
  { clue:"Absurd dream", word1:"absurd", word2:"dream", answer:"surreal", tri1:"sur", tri2:"rea" },
  { clue:"Summer sunset", word1:"summer", word2:"sunset", answer:"immense", tri1:"mme", tri2:"nse" },
  { clue:"Puzzles granny", word1:"puzzles", word2:"granny", answer:"rankles", tri1:"les", tri2:"ran" },
  { clue:"Custom jigsaw", word1:"custom", word2:"jigsaw", answer:"sawdust", tri1:"ust", tri2:"saw" },
  { clue:"Fresh socks", word1:"fresh", word2:"socks", answer:"restock", tri1:"res", tri2:"ock" },
  { clue:"Rotten tycoon!", word1:"rotten", word2:"tycoon", answer:"boycott", tri1:"ott", tri2:"yco" },
  { clue:"Butch alien", word1:"butch", word2:"alien", answer:"halibut", tri1:"but", tri2:"ali" },
  { clue:"Pancake ordeal", word1:"pancake", word2:"ordeal", answer:"deadpan", tri1:"pan", tri2:"dea" },
  { clue:"Embrace rawness", word1:"embrace", word2:"rawness", answer:"braless", tri1:"bra", tri2:"ess" },
  { clue:"Trucker reunion", word1:"trucker", word2:"reunion", answer:"ruction", tri1:"ruc", tri2:"ion" },
  { clue:"Bamboo catalog", word1:"bamboo", word2:"catalog", answer:"logbook", tri1:"boo", tri2:"log" },
  { clue:"Pesky waiver", word1:"pesky", word2:"waiver", answer:"skydive", tri1:"sky", tri2:"ive" },
  { clue:"Pasta sarcasm", word1:"pasta", word2:"sarcasm", answer:"starchy", tri1:"sta", tri2:"arc" },
  { clue:"Cheeky bishop!", word1:"cheeky", word2:"bishop", answer:"cherish", tri1:"che", tri2:"ish" },
  { clue:"Emotion robbed", word1:"emotion", word2:"robbed", answer:"robotic", tri1:"oti", tri2:"rob" },
  { clue:"Coffee breath", word1:"coffee", word2:"breath", answer:"offbeat", tri1:"off", tri2:"eat" },
  { clue:"Divorce payment", word1:"divorce", word2:"payment", answer:"percent", tri1:"rce", tri2:"ent" },
  { clue:"Hippo's radius", word1:"hippos", word2:"radius", answer:"adipose", tri1:"pos", tri2:"adi" },
  { clue:"Popular encore", word1:"popular", word2:"encore", answer:"popcorn", tri1:"pop", tri2:"cor" },
  { clue:"Campus admirer", word1:"campus", word2:"admirer", answer:"vampire", tri1:"amp", tri2:"ire" },
  { clue:"Apple drama", word1:"apple", word2:"drama", answer:"trample", tri1:"ple", tri2:"ram" },
  { clue:"Modify image", word1:"modify", word2:"image", answer:"magnify", tri1:"ify", tri2:"mag" },
  { clue:"Karaoke wonder", word1:"karaoke", word2:"wonder", answer:"parader", tri1:"ara", tri2:"der" },
  { clue:"Curious mailman", word1:"curious", word2:"mailman", answer:"curtail", tri1:"cur", tri2:"ail" },
  { clue:"Atomic secrets", word1:"atomic", word2:"secrets", answer:"creator", tri1:"ato", tri2:"cre" },
  { clue:"Incense factory", word1:"incense", word2:"factory", answer:"sensory", tri1:"ens", tri2:"ory" },
  { clue:"Crafty madame", word1:"crafty", word2:"madame", answer:"macrame", tri1:"cra", tri2:"ame" },
  { clue:"Jinxed bonbon", word1:"jinxed", word2:"bonbon", answer:"unboxed", tri1:"xed", tri2:"nbo" },
  { clue:"Laundry cleaner", word1:"laundry", word2:"cleaner", answer:"mundane", tri1:"und", tri2:"ane" },
  { clue:"Wholly muscle?", word1:"wholly", word2:"muscle", answer:"mollusc", tri1:"oll", tri2:"usc" },
  { clue:"Stupid gossip", word1:"stupid", word2:"gossip", answer:"insipid", tri1:"pid", tri2:"sip" },
  { clue:"Winter weaver", word1:"winter", word2:"weaver", answer:"sweater", tri1:"ter", tri2:"wea" },
  { clue:"Shark pontoon", word1:"shark", word2:"pontoon", answer:"harpoon", tri1:"har", tri2:"oon" },
  { clue:"Koalas launch!", word1:"koalas", word2:"launch", answer:"unclasp", tri1:"las", tri2:"unc" },
  { clue:"Junior minds", word1:"junior", word2:"minds", answer:"minions", tri1:"nio", tri2:"min" },
  { clue:"Library trolley", word1:"library", word2:"trolley", answer:"braille", tri1:"bra", tri2:"lle" },
  { clue:"Bikini weather!", word1:"bikini", word2:"weather", answer:"gherkin", tri1:"kin", tri2:"her" },
  { clue:"Savage queens", word1:"savage", word2:"queens", answer:"teenage", tri1:"age", tri2:"een" },
  { clue:"Pursue beauty", word1:"pursue", word2:"beauty", answer:"auteurs", tri1:"urs", tri2:"aut" },
  { clue:"Toasted success!", word1:"toasted", word2:"success", answer:"hostess", tri1:"ste", tri2:"ess" },
  { clue:"Beyond cryptic", word1:"beyond", word2:"cryptic", answer:"cryonic", tri1:"yon", tri2:"cry" },
  { clue:"Axolotl anarchy", word1:"axolotl", word2:"anarchy", answer:"blotchy", tri1:"lot", tri2:"chy" },
  { clue:"Thorny upstart", word1:"thorny", word2:"upstart", answer:"warthog", tri1:"tho", tri2:"art" },
  { clue:"Inane hiccup?", word1:"inane", word2:"hiccup", answer:"chicane", tri1:"ane", tri2:"hic" },
  { clue:"Podcast blunder", word1:"podcast", word2:"blunder", answer:"astound", tri1:"ast", tri2:"und" },
  { clue:"Titanic struck!", word1:"titanic", word2:"struck", answer:"tantrum", tri1:"tan", tri2:"tru" },
  { clue:"Damaged thumbs", word1:"damaged", word2:"thumbs", answer:"umbrage", tri1:"age", tri2:"umb" },
  { clue:"Monthly malice", word1:"monthly", word2:"malice", answer:"alimony", tri1:"mon", tri2:"ali" },
  { clue:"Switch phones", word1:"switch", word2:"phones", answer:"witness", tri1:"wit", tri2:"nes" },
  { clue:"Tamed debate", word1:"tamed", word2:"debate", answer:"mediate", tri1:"med", tri2:"ate" },
  { clue:"Lonely Martian", word1:"lonely", word2:"martian", answer:"elysian", tri1:"ely", tri2:"ian" },
  { clue:"Raunchy truth", word1:"raunchy", word2:"truth", answer:"uncouth", tri1:"unc", tri2:"uth" },
  { clue:"Nearly walked", word1:"nearly", word2:"walked", answer:"sneaked", tri1:"nea", tri2:"ked" },
  { clue:"Hazard symbol", word1:"hazard", word2:"symbol", answer:"bollard", tri1:"ard", tri2:"bol" },
  { clue:"Perform, monkey!", word1:"perform", word2:"monkey", answer:"hormone", tri1:"orm", tri2:"mon" },
  { clue:"Further charges", word1:"further", word2:"charges", answer:"harsher", tri1:"her", tri2:"har" },
  { clue:"Excess whiskey", word1:"excess", word2:"whiskey", answer:"keyless", tri1:"ess", tri2:"key" },
  { clue:"Ukulele museum", word1:"ukulele", word2:"museum", answer:"useless", tri1:"ele", tri2:"use" },
  { clue:"Macho spandex", word1:"macho", word2:"spandex", answer:"panache", tri1:"ach", tri2:"pan" },
  { clue:"Chaotic grandma", word1:"chaotic", word2:"grandma", answer:"frantic", tri1:"tic", tri2:"ran" },
  { clue:"Ninety friends", word1:"ninety", word2:"friends", answer:"variety", tri1:"ety", tri2:"rie" },
  { clue:"Forged ballot", word1:"forged", word2:"ballot", answer:"alleged", tri1:"ged", tri2:"all" },
  { clue:"Better apology", word1:"better", word2:"apology", answer:"politer", tri1:"ter", tri2:"pol" },
  { clue:"Grabbed hummus", word1:"grabbed", word2:"hummus", answer:"thumbed", tri1:"bed", tri2:"hum" },
  { clue:"Woven lullaby", word1:"woven", word2:"lullaby", answer:"novella", tri1:"ove", tri2:"lla" },
  { clue:"Smooth haptic", word1:"smooth", word2:"haptic", answer:"osmotic", tri1:"smo", tri2:"tic" },
  { clue:"Artisan cakes", word1:"artisan", word2:"cakes", answer:"partake", tri1:"art", tri2:"ake" },
  { clue:"Heroic abandon", word1:"heroic", word2:"abandon", answer:"android", tri1:"roi", tri2:"and" },
  { clue:"Toilet jostle!", word1:"toilet", word2:"jostle", answer:"hostile", tri1:"ile", tri2:"ost" },
  { clue:"Circus target", word1:"circus", word2:"target", answer:"custard", tri1:"cus", tri2:"tar" },
  { clue:"Castle echoes", word1:"castle", word2:"echoes", answer:"chortle", tri1:"tle", tri2:"cho" },
  { clue:"Ignite nickel", word1:"ignite", word2:"nickel", answer:"nitpick", tri1:"nit", tri2:"ick" },
  { clue:"Gumboot suction", word1:"gumboot", word2:"suction", answer:"succumb", tri1:"umb", tri2:"suc" },
  { clue:"Kitchen slogan", word1:"kitchen", word2:"slogan", answer:"ganache", tri1:"che", tri2:"gan" },
  { clue:"Airport hordes", word1:"airport", word2:"hordes", answer:"despair", tri1:"air", tri2:"des" },
  { clue:"Toned cowboy", word1:"toned", word2:"cowboy", answer:"jawbone", tri1:"one", tri2:"wbo" },
  { clue:"Genial words", word1:"genial", word2:"words", answer:"cordial", tri1:"ial", tri2:"ord" },
  { clue:"Wildly hungry", word1:"wildly", word2:"hungry", answer:"ungodly", tri1:"dly", tri2:"ung" },
  { clue:"Harsh pencil", word1:"harsh", word2:"pencil", answer:"sharpen", tri1:"har", tri2:"pen" },
  { clue:"Raccoon scuffle!", word1:"raccoon", word2:"scuffle", answer:"buffoon", tri1:"oon", tri2:"uff" },
  { clue:"Silent heels", word1:"silent", word2:"heels", answer:"genteel", tri1:"ent", tri2:"eel" },
  { clue:"Escaped turkey", word1:"escaped", word2:"turkey", answer:"capture", tri1:"cap", tri2:"tur" },
  { clue:"Discard fruit", word1:"discard", word2:"fruit", answer:"biscuit", tri1:"isc", tri2:"uit" },
  { clue:"Upstage comedy?", word1:"upstage", word2:"comedy", answer:"tragedy", tri1:"age", tri2:"edy" },
  { clue:"Sunrise alarm", word1:"sunrise", word2:"alarm", answer:"malaise", tri1:"ise", tri2:"ala" },
  { clue:"Beguile prince", word1:"beguile", word2:"prince", answer:"silence", tri1:"ile", tri2:"nce" },
  { clue:"Awesome pitch!", word1:"awesome", word2:"pitch", answer:"epitome", tri1:"ome", tri2:"pit" },
  { clue:"Husband erred", word1:"husband", word2:"erred", answer:"errands", tri1:"and", tri2:"err" },
  { clue:"Conceal milkman", word1:"conceal", word2:"milkman", answer:"romance", tri1:"nce", tri2:"man" },
  { clue:"Azure outfit", word1:"azure", word2:"outfit", answer:"couture", tri1:"ure", tri2:"out" },
  { clue:"Surveil mobster", word1:"surveil", word2:"mobster", answer:"observe", tri1:"rve", tri2:"obs" },
  { clue:"Storms adobe?", word1:"storms", word2:"adobe", answer:"tornado", tri1:"tor", tri2:"ado" },
  { clue:"Achieve plural?", word1:"achieve", word2:"plural", answer:"several", tri1:"eve", tri2:"ral" },
  { clue:"Grubby tricks", word1:"grubby", word2:"tricks", answer:"rubrics", tri1:"rub", tri2:"ric" },
  { clue:"Marched along", word1:"marched", word2:"along", answer:"echelon", tri1:"che", tri2:"lon" },
  { clue:"Stamina, golly", word1:"stamina", word2:"golly", answer:"finally", tri1:"ina", tri2:"lly" },
  { clue:"Bounty mania", word1:"bounty", word2:"mania", answer:"manhunt", tri1:"unt", tri2:"man" },
  { clue:"Citrus riots!", word1:"citrus", word2:"riots", answer:"vitriol", tri1:"itr", tri2:"rio" },
  { clue:"Market chutney", word1:"market", word2:"chutney", answer:"ketchup", tri1:"ket", tri2:"chu" },
  { clue:"Stolen memory", word1:"stolen", word2:"memory", answer:"history", tri1:"sto", tri2:"ory" },
  { clue:"Funky chicken!", word1:"funky", word2:"chicken", answer:"drunken", tri1:"unk", tri2:"ken" },
  { clue:"Outback erosion", word1:"outback", word2:"erosion", answer:"reroute", tri1:"out", tri2:"ero" },
  { clue:"Whose finery?", word1:"whose", word2:"finery", answer:"hosiery", tri1:"hos", tri2:"ery" },
  { clue:"Crypto babble", word1:"crypto", word2:"babble", answer:"crybaby", tri1:"cry", tri2:"bab" },
  { clue:"Fairly acute", word1:"fairly", word2:"acute", answer:"haircut", tri1:"air", tri2:"cut" },
  { clue:"Anchovy drizzle", word1:"anchovy", word2:"drizzle", answer:"chorizo", tri1:"cho", tri2:"riz" },
  { clue:"Danger, mishaps", word1:"danger", word2:"mishaps", answer:"anguish", tri1:"ang", tri2:"ish" },
  { clue:"Cadet arsenal", word1:"cadet", word2:"arsenal", answer:"grenade", tri1:"ade", tri2:"ena" },
  { clue:"Sworn unique", word1:"sworn", word2:"unique", answer:"unicorn", tri1:"orn", tri2:"uni" },
  { clue:"Extant threat", word1:"extant", word2:"threat", answer:"anthrax", tri1:"ant", tri2:"thr" },
  { clue:"Carbon refills", word1:"carbon", word2:"refills", answer:"careful", tri1:"car", tri2:"ref" },
  { clue:"Laser sighted!", word1:"laser", word2:"sighted", answer:"blasted", tri1:"las", tri2:"ted" },
  { clue:"Nightly affray", word1:"nightly", word2:"affray", answer:"fraught", tri1:"ght", tri2:"fra" },
  { clue:"Slammed pothole", word1:"slammed", word2:"pothole", answer:"mammoth", tri1:"amm", tri2:"oth" },
  { clue:"Granny, please?", word1:"granny", word2:"please", answer:"grapple", tri1:"gra", tri2:"ple" },
  { clue:"Armpit revenge", word1:"armpit", word2:"revenge", answer:"impinge", tri1:"mpi", tri2:"nge" },
  { clue:"Feisty temper", word1:"feisty", word2:"temper", answer:"persist", tri1:"ist", tri2:"per" }

];


/* =======================
   Trimmed core (single mode)
   Removed: hints UI, trigram highlighting/dragging, clue-word trigram actions,
            typed trigram auto-promotion, skill scoring, assisted mode.
   Kept: message system + copy, clue underlines, hint button (no-op), skill badge slot.
   ======================= */

const LS_KEY = "trigramGameStats_v1";

/* --- Keep existing message copy (even if unused for now) --- */
const MAX3_TEXT      = "Max 3 contiguous letters allowed";
const TWOTRI_TEXT    = "Two trigrams from same word";
const OVERLAP_TEXT   = "1-letter overlap allowed ‚úì";
const OVERLAP2_TEXT  = "2-letter overlap not allowed";
const HINT_EXCL_TEXT = "Your hint excluded this trigram";
const DBLTAP_TEXT    = "Double tap to cycle";

/* --- DOM --- */
const el = {
  wrap: document.getElementById("wrap") || document.querySelector(".wrap"),
  clue: document.getElementById("clue"),
  grid: document.getElementById("grid"),
  msg: document.getElementById("msg"),
  hintsBtn: document.getElementById("hintsBtn"),
  checkBtn: document.getElementById("checkBtn"),
  nextPuzzleBtn: document.getElementById("nextPuzzleBtn"),
  prevBtn: document.getElementById("prevBtn"),
  nextBtn: document.getElementById("nextBtn"),
  count: document.getElementById("count"),
  kbHost: document.getElementById("kbHost"),
  helpBtn: document.getElementById("helpBtn"),
  helpOverlay: document.getElementById("helpOverlay"),
  helpClose: document.getElementById("helpClose"),
  skillBadgeValue: document.getElementById("skillBadgeValue"),
};

const htmlEl = document.documentElement;

/* --- State --- */
const state = {
  i: 0,
  n: 7,
  grid: [],
  focus: 0,
  finished: false,
  gaveUp: false,
  hintCount: 0,      // kept for message text compatibility
  useKB: false,
  modalOpen: false,
  transientTimer: null,
};

precomputePuzzles();
setSkillBadgePlaceholder();
wireUI();
setPuzzleIndex(firstIncompleteIndex());
ensureKeyboardMode();
renderAll();

/* =======================
   Puzzles + helpers
   ======================= */
function precomputePuzzles(){
  for(const p of PUZZLES){
    p._ans = String(p.answer).toUpperCase();
    p._clue = String(p.clue || "").trim();
  }
}
function cur(){ return PUZZLES[state.i]; }
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
function isAlpha(ch){ return /^[A-Z]$/.test(ch); }
function hintPhraseText(h){
  if(h<=0) return "no hints";
  if(h===1) return "1 hint";
  return `${h} hints`;
}

/* =======================
   Storage (minimal, no skill scoring)
   ======================= */
function canLS(){
  try{
    const k="__tg_test__";
    localStorage.setItem(k,"1");
    localStorage.removeItem(k);
    return true;
  }catch(e){ return false; }
}
function loadStore(){
  const blank = { results:{}, progress:{} };
  if(!canLS()) return blank;
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return blank;
    const obj = JSON.parse(raw);
    obj.results = obj.results && typeof obj.results==="object" ? obj.results : {};
    obj.progress = obj.progress && typeof obj.progress==="object" ? obj.progress : {};
    return obj;
  }catch(e){ return blank; }
}
const STORE = loadStore();
function saveStore(){
  if(!canLS()) return;
  try{ localStorage.setItem(LS_KEY, JSON.stringify(STORE)); }catch(e){}
}
function firstIncompleteIndex(){
  for(let i=0;i<PUZZLES.length;i++){
    const r = STORE.results[String(i)];
    if(!(r && r.done)) return i;
  }
  return 0;
}

/* =======================
   Navigation + load
   ======================= */
function setPuzzleIndex(i){
  state.i = clamp(i, 0, PUZZLES.length-1);
  state.n = cur()._ans.length;
  state.grid = Array(state.n).fill("");
  state.focus = 0;
  state.finished = false;
  state.gaveUp = false;

  const res = STORE.results[String(state.i)];
  if(res && res.done){
    state.finished = true;
    state.gaveUp = !!res.gaveUp;
    state.hintCount = Number(res.hintCount||0) || 0;
    state.grid = cur()._ans.split("");
    el.wrap && el.wrap.classList.add("solved");
    setMsg(state.gaveUp ? "You gave up!" : `Correct - ${hintPhraseText(state.hintCount)}!`);
  }else{
    el.wrap && el.wrap.classList.remove("solved");
    setMsg("");
  }
  setSkillBadgePlaceholder();
}

/* =======================
   Render
   ======================= */
function renderAll(){
  renderClue();
  renderCount();
  renderGrid();
  renderButtons();
}
function renderClue(){
  if(!el.clue) return;
  const parts = cur()._clue.trim().split(/\s+/);
  if(parts.length >= 2){
    const a = parts[0];
    const b = parts.slice(1).join(" ");
    el.clue.innerHTML =
      `<span class="clueWord"><span class="u-w1">${escapeHtml(a)}</span></span> ` +
      `<span class="clueWord"><span class="u-w2">${escapeHtml(b)}</span></span>`;
  }else{
    el.clue.textContent = cur()._clue;
  }
}
function renderCount(){
  if(el.count) el.count.textContent = `${state.i+1}/${PUZZLES.length}`;
}
function renderGrid(){
  if(!el.grid) return;
  el.grid.innerHTML = "";
  for(let i=0;i<state.n;i++){
    const cell = document.createElement("button");
    cell.type="button";
    cell.className="cell";
    if(!state.finished && i===state.focus) cell.classList.add("active");

    const inp = document.createElement("input");
    inp.maxLength=1;
    inp.value = state.grid[i] || "";
    const readonly = state.useKB || state.finished;
    inp.readOnly = readonly;
    inp.inputMode = readonly ? "none" : "text";
    inp.tabIndex = readonly ? -1 : 0;

    inp.addEventListener("keydown", (e)=>onKeyDown(e,i));
    inp.addEventListener("input", (e)=>onNativeInput(e,i));
    cell.addEventListener("pointerdown", (e)=>{
      if(state.finished) return;
      state.focus=i;
      renderGridActiveOnly();
      if(!state.useKB) setTimeout(()=>inp.focus(),0);
      e.preventDefault();
    });

    cell.appendChild(inp);
    el.grid.appendChild(cell);
  }
}
function renderGridActiveOnly(){
  const cells = el.grid.querySelectorAll(".cell");
  cells.forEach((c,idx)=>c.classList.toggle("active", !state.finished && idx===state.focus));
}
function renderButtons(){
  if(el.hintsBtn) el.hintsBtn.disabled = !!state.finished; // no-op but kept
  if(el.checkBtn){
    const ready = !state.finished && state.grid.every(ch=>!!ch);
    el.checkBtn.disabled = !ready;
    el.checkBtn.classList.toggle("ready", ready);
  }
  if(el.prevBtn) el.prevBtn.disabled = state.i<=0;
  if(el.nextBtn) el.nextBtn.disabled = state.i>=PUZZLES.length-1;
}

/* =======================
   Input
   ======================= */
function setChar(i,ch){ state.grid[i]=ch; renderButtons(); }
function typeLetter(ch){
  if(state.finished || !isAlpha(ch)) return;
  setChar(state.focus, ch);
  state.focus = clamp(state.focus+1,0,state.n-1);
  renderAll();
}
function backspace(){
  if(state.finished) return;
  if(state.grid[state.focus]){
    setChar(state.focus,"");
  }else if(state.focus>0){
    state.focus--;
    setChar(state.focus,"");
  }
  renderAll();
}
function onKeyDown(e, idx){
  if(state.useKB || state.finished) return;
  if(e.key==="Backspace"){ e.preventDefault(); state.focus=idx; backspace(); }
  if(e.key==="Enter"){ e.preventDefault(); onCheck(); }
  if(e.key.length===1){
    const up=e.key.toUpperCase();
    if(isAlpha(up)){ e.preventDefault(); state.focus=idx; typeLetter(up); }
  }
}
function onNativeInput(e, idx){
  if(state.useKB || state.finished){
    e.target.value = state.grid[idx] || "";
    return;
  }
  const v=(e.target.value||"").toUpperCase().slice(-1);
  state.focus=idx;
  if(isAlpha(v)) typeLetter(v);
  else setChar(idx,"");
  e.target.value = state.grid[idx] || "";
}

/* =======================
   Check
   ======================= */
function onCheck(){
  if(state.finished) return;
  if(state.grid.some(ch=>!ch)){
    setTransientMsg(`Fill all ${state.n} tiles first.`, 1400);
    return;
  }
  const attempt = state.grid.join("").toUpperCase();
  if(attempt===cur()._ans){
    state.finished=true;
    el.wrap && el.wrap.classList.add("solved");
    STORE.results[String(state.i)] = {done:true, gaveUp:false, hintCount: state.hintCount, ts:Date.now()};
    saveStore();
    setSkillBadgePlaceholder();
    setMsg(`Correct - ${hintPhraseText(state.hintCount)}!`);
    renderAll();
  }else{
    setTransientMsg("Not quite.", 1200);
  }
}

/* =======================
   UI wiring
   ======================= */
function wireUI(){
  if(el.hintsBtn) el.hintsBtn.addEventListener("click", (e)=>e.preventDefault()); // no-op
  if(el.checkBtn) el.checkBtn.addEventListener("click", (e)=>{ e.preventDefault(); onCheck(); });
  if(el.prevBtn) el.prevBtn.addEventListener("click", (e)=>{ e.preventDefault(); setPuzzleIndex(state.i-1); renderAll(); });
  if(el.nextBtn) el.nextBtn.addEventListener("click", (e)=>{ e.preventDefault(); setPuzzleIndex(state.i+1); renderAll(); });
}

/* =======================
   Messages
   ======================= */
function setMsg(html){
  if(!el.msg) return;
  el.msg.innerHTML = html || "";
}
function setTransientMsg(txt, ms=1200){
  clearTransientMsg();
  setMsg(escapeHtml(txt));
  state.transientTimer=setTimeout(()=>{ setMsg(""); state.transientTimer=null; }, ms);
}
function clearTransientMsg(){
  if(state.transientTimer){ clearTimeout(state.transientTimer); state.transientTimer=null; }
}
function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
                  .replaceAll('"',"&quot;").replaceAll("'","&#39;");
}

/* =======================
   Skill badge placeholder (kept)
   ======================= */
function setSkillBadgePlaceholder(){
  if(el.skillBadgeValue) el.skillBadgeValue.textContent="‚Äî";
}

/* =======================
   Custom keyboard (optional)
   ======================= */
function shouldUseCustomKB(){
  const coarse = window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
  return coarse || window.innerWidth < 740;
}
function ensureKeyboardMode(){
  const want = shouldUseCustomKB();
  if(state.useKB===want) return;
  state.useKB=want;
  htmlEl.classList.toggle("has-kb", want);
}

</script>


</body>
</html>
